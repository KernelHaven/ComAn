2000-09-25 21:28:07 +0000
diff --git a/Changelog b/Changelog
index a605a1c..b374845 100644
--- a/Changelog
+++ b/Changelog
@@ -1,756 +1,762 @@
 0.47
 
-	* Tons of bugfixes.
 	* A bug in syslogd was fixed that allowed it to potentially fork-bomb
 	    your system.
+	* Renamed busybox.defs.h to the more sensible "Config.h"
+	* Improved portability between different libcs.
+	* Many apps ported to use getopt()
+	* Common handling of '--help'
+	* All usage messages centralized.
+	* Added a bunch of new commands:
+	    * 'rdate' contributed by Sterling Huxley <sterling@europa.com>
+	    * 'wget' contributed by Chip Rosenthal <chip@unicom.com>, 
+		    <crosenth@covad.com> and Covad Communications
+	    * 'getopt' from "Alfred M. Szmidt" <ams@trillian.itslinux.org>
+	    * dos2unix, unix2dos, reset, and unrpm.c (and lots of help
+		debugging) thanks to robotti@metconnect.com.
+	    * 'renice' command, thanks to Dave Cinege <dcinege@psychosis.com>
+	    * 'xargs' (written by me)
+	    * 'expr' contributed by Edward Betts <edward@debian.org>, based
+		on GNY expr
+	* lsmod now uses the query_module syscall, rather then /proc (me)
+	* syslogd can now log messages to remote hosts -- patch thanks
+	    to Gyepi Sam <gyepi@praxis-sw.com>
 	* chroot can now call the builtin shell - Pavel Roskin <proski@gnu.org>
-	* added 'renice' command, thanks to Dave Cinege <dcinege@psychosis.com>
 	* 'make install' now creates relative symlinks, and added a new
 	    'make install-hardlinks' target to (tada) install hardlinks.
-	* syslogd can now log messages to remote hosts -- patch thanks
-	    to Gyepi Sam <gyepi@praxis-sw.com>
 	* Rewrite of 'tail' to make it simpler, smaller, and more robust.  
 	    It now weighs only 2.25k (3k when full featured).  The code is
 	    cleaner too, thanks to Allen Soard <esp-software@mail.hypermart.net>
 	* Add optional ls file sorting, thanks to a patch from 
 	    Sterling Huxley <sterling@europa.com>
-	* Added 'rdate' command from Sterling Huxley <sterling@europa.com>
-	* Added 'wget' command, contributed by Chip Rosenthal <chip@unicom.com>, 
-		<crosenth@covad.com> and Covad Communications
-	* Added 'getopt' from "Alfred M. Szmidt" <ams@trillian.itslinux.org>
-	* Added dos2unix, unix2dos, and unrpm.c thanks to robotti@metconnect.com.
-	* Added xargs (written by me)
-	* lsmod now uses the query_module syscall, rather then /proc (me)
 	* Fixed chmod option parsing so things like 'chmod -r /tmp/file'
-	    wouldn't work (since it thought -r was an option).  Doh!
+	    now work (previously it thought -r was an option).  Doh!
 	* Fixed tar handling of stdin and stdout
-	* Many apps ported to use getopt()
-	* All usage messages centralized.
-	* Common handling of '--help'
-	* Improved portability between different libcs.
+	* Preliminary support for GNU HURD.
+	* Tons of other bugfixes.
 
 
 	 -Erik Andersen
 
 
 0.46
 
 	* Better portability.  Now should compile cleanly with libc5, 
 	    GNU libc 2.0 and 2.1, and various Linux kernels including 
 	    2.0.x, 2.2.x, and to 2.4.0-test*. (patch for 2.4.x kernels
 	    to make /proc/mounts behave included in the kernel-patches dir). 
 	* Fixed a _horrible_ bug where 'tar -tvf' could unlink
 	    local files that matched tarball contents!!!  Fix thanks 
 	    to Marius Groeger <mgroeger@sysgo.de>
 	* Fixed a nasty bug in tar when could mess up saved symlinks.
 	* Fixed tar creation support when reading from stdin ('tar -cf - . ') 
 	    thanks to Daniel Quinlan <quinlan@transmeta.com>
 	* Updates to handle Linux 2.4.0 kernels (kludged around the
 	    "none" entries in /proc/mounts, added a hack to make sysinfo
 	    work with both old and new kernels).
 	* Fixed insmod module option parsing for options lacking an '='.
 	    Fix thanks to Marc Nijdam <marc_nijdam@hp.com>
 	* Fixed segfault with 'cut -f 1 -d:' and added 'cut -s' suport.
 	    Fix thanks to Arne Bernin <arne@matrix.loopback.org>
 	* Several fixes from Marius Groeger <mag@sysgo.de>
 	    - Added support for "sh -c command args..."
 	    - Fixed globbing, i.e. 'echo * *' and 'echo "******"' now work.
 	    - Added shell environment variable substitution 
 	    - Added the "read" shell builtin.
 	* Fixed cursor editing in cmdedit.c. The following keyboard sequence 
 	    used to create an infinite loop: ls, cursor up, left, down.
 	* Added support for being a login shell, so things like
 	    '-su' or '-sh' (stuff where argv[0][0]=='-') will now always 
 	    invoke the shell.  Now you can use BusyBox as a login shell.
 	* ls.c now ignores '-g', since some ftp clients like that sort 
 	    of thing.  Patch thanks to David Vrabel <dvrabel@arcom.co.uk>
 	* Fix to init.c from Stuart Menefy <Stuart.Menefy@st.com> so that
 	    it always sets the controlling terminal before running any programs
 	* Several fixes from Matt Kraai <kraai@alumni.carnegiemellon.edu>
 	    - Fixed tr so it recognizes standard escape sequences.  
 		Merged common escape seq. code from tr and echo into utility.c.
 	    - Major work in updating/cleaning up the docs, and getting the
 		new SGML based docs into shape.
 	    - cleanup of ar.c
 	    - BusyBox should now poweroff when asked to do so.
 	    - Fixed 'ln -n' and 'ln -s' so they both work properly.
 	* Reorganized signal names in kill.c for better architecture support 
 	    -- patch thanks to simon wood <simon@mungewell.uklinux.net>
 	* In 0.43, backspace and delete worked properly, but with 0.45, 
 	    it just echoed a ^? for backspace, and ^H for control-h.  This
 	    was due to a broken macro in init.c, that is now fixed.
 	* Removed sfdisk from BusyBox.  It was buggy, fat, and we really
 	    couldn't maintain it very well, so including it was not really
 	    very appropriate.  Those wanting an fdisk are invited to
 	    grab a copy from util-linux.
 	* Added 'dumpkmap' to allow people to dump a binary keymap, which can 
 	    then be loaded in by 'loadkmap' -- submitted by
 	    Arne Bernin <arne@matrix.loopback.org>
 	* Fixed NFS so it supports 2.4.x kernels and NFSv3.
 	* Brand, new versions of grep and sed which use libc regex routines,
 	    thanks to Mark Whitley <markw@lineo.com>.  The hand-tooled 
 	    "regexp.[ch]" files have been removed. Much help on these from 
 	    Matt Kraai as well.
 
 
 	 -Erik Andersen
 
 
 0.45
 	* Now compiles vs libc5 (which can save lots of space for 
 	    embedded systems).
 	* Added BB_FEATURE_TRIVIAL_HELP which compiles out most all of the
 	    help messages (i.e --help).  Saves 17k over a full compile.
 	* Added cut and tr from minix, since due to the license change, 
 	    we can now use minix code.  Minix tr saves 4k. 
 	* insmod now works.  It costs 29k, but imagine an initrd with a 
 	    staticly linked busybox containing only insmod and sh, a few /dev 
 	    entries, and a kernel module or two...  It doesn't get smaller
 	    then this folks (I pity the fool that writes insmod in asm ;-).
 	    Many kudos go to Ron Alder <alder@lineo.com> for finishing this off!
 	* Added a mini ar archive utility, especially written for BusyBox by 
 	    Glenn McGrath <bug1@netconnect.com.au>
 	* Added mktemp, contributed by Daniel Jacobowitz <dan@debian.org>
 	* Added setkeycodes, for those that have wierd keyboard buttons.
 	* Added md5sum, uuencode and uudecode -- thanks to Alfred M. Szmidt 
 	    <ams@trillian.itslinux.org> for contributing these.
         * Added 'grep -v' option (inverted search) and updated 
 	    docs accordingly.  -beppu
 	* Wrote which
 	* Replaced the telnet implementation with one written by 
 	    Tomi Ollila <too@iki.fi> It works great and costs 3k.
 	* BusyBox sh (lash) now supports being used as a standalone shell.  When
 	    BB_FEATURE_SH_STANDALONE_SHELL is defined, all the busybox commands may
 	    be invoked as shell internals.  Best used when compiling staticly 
 	    (i.e. DOSTATIC=true)
 	* BusyBox sh (lash) internals now behave as expected wrt pipes 
 	    and redirects. 
 	* Fixed ping warnings -- fix from Sascha Ziemann <szi@aibon.ping.de>
 	* Fixed update segfault
 	* Fixed mknod -- minor number was always 0
 	* Fixed tar option parsing, so both "tar xvf foo.tar" and 
 	    "tar -xvf foo.tar" now work (i.e. no "-" before options) 
 	    (this was very broken in 0.43).
 	* Several contributions from Randolph Chung <tausq@debian.org>.
 	    * cp/mv now accepts the -f flag
 	    * tail can now accept -<num> commands (e.g. -10) for better 
 		compatibility with the standard tail command
 	    * added a simple id implementation; doesn't support sup. groups yet
 	* logname used getlogin(3) which uses utmp.  Now it doesn't. 
 	* whoami used getpwuid(3) which uses libc NSS.  Now it behaves. 
 	* Add support for "noatime" and "nodiratime" mount flags to mount.
 	* Changed 'umount -f' to mean force, and actually use umount2.
 	* Changed 'umount -l' to mean "Do not free loop device".
 	* Fixed basename to support stripping of suffixes.  Patch thanks
 	    to xiong jianxin <jxiong@uiuc.edu>
 	* cp -fa now works as expected for symlinks (it didn't before)
 	* zcat now works (wasn't working since option parsing was broken)
 	* Renamed "mnc" to the more correct "nc" (for netcat).
 	* Makefile intelligence updates
 	* Changed the way init parses /etc/inittab entries to avoid problems
 	    with commands that contain colons in them.  Fix thanks to 
 	    Pavel Roskin <proski@gnu.org>
 	* Fixed a warning in utility.c due to char being unsigned on Linux/PPC, 
 	    Fix thanks to Pavel Roskin <proski@gnu.org>
 	* Made "killall" complain (not error and exit) about processes that it 
 	    cannot find by name -- Pavel Roskin <proski@gnu.org> 
 	* Fixed more and ps to have sensible terminal width defaults, thanks 
 	    to Pavel Roskin.
 	* Fixed all fatalError() calls lacking a "\n", thanks to Pavel Roskin.
 	* Fixed a segfault in yes when no args were given -- Pavel Roskin.
 	* Simplified freeramdisk and added argument checking -- Pavel Roskin. 
 	* Fixed segfault caused by "touch -c"
 	* Fixed segfault caused by "rm -f"
 	* Fixed segfault caused by "ln -s -s" and similar abuses. Further fixes
 	    and "--" support from Pavel Roskin.
 	* Fixed segfault caused by "cp -a -a" and similar abuses.
 	* Implemented "rm -- <foo>". Implementation fixed by Pavel Roskin.
 	* "which" rewritten to use stat(). Fixes to improve its compatability
 	    with traditional implementations -- Pavel Roskin.
 	* "mount" now reports errors from nfsmount() and assumes NFS mount
 	    if ':' is present in the device name - Pavel Roskin
 	* Fixed exit status for killall - Pavel Roskin
 	* Fixed 'swapon -a' and 'swapoff -a', which were broken.
 	* Fixed 'mount -a' so it works as expected.
 	* Implemented 'ls -R' (enabled by enabling BB_FEATURE_LS_RECURSIVE)
 	* Implemented "ping -s", fixed error messages and argument parsing -
 	    Pavel Roskin
 	* Syslogd will not go to background if "-n" is given. Better help
 	    and argument checking -- Pavel Roskin
 	* Fixed a small bug that could cause tar to emit warning messages
 	    and not extract the first file in a directory in some cases
 	    of nested directories.  Thanks to Kevin Traas <kevin@netmaster.com>
 	    for helping track this one down.
 	* More doc updates
 	* Fixed grep "Line too long" problem -- John Beppu
 	* Fixed 'grep -q -i B some_file' so it works
 	* math takes input from stdin if no args are given.  -- John Beppu
 	* math was renamed to dc.  Although it deviates from dc's behaviour,
 	    this will probably be remedied in the future.  -- John Beppu
 
 
 	 -Erik Andersen, June 21, 2000
 
 
 0.44
 	Previously, an erronous announcement of BusyBox 0.44 was made, so to 
 	avoid possible confusion, we are skipping straight to 0.45, and calling
 	it good.
 
 	 -Erik Andersen
 
 
 0.43
 	* Major update to the provided documentation.
 	* Busybox now includes a shell!  It currently costs 7.5 k (plus an
 	    additional 2.5 k if you compile in command line editing).  Handles
 	    job control, has the usual set of builtins, and does everything
 	    except for handling programming statements (if, while, etc...)
 	* Busybox can now work perfectly when /proc is disabled, thereby 
 	    saving a bunch of memory (kernel /proc support is not thin).  This
 	    is done by making use of some nice kernel patches I wrote up to
 	    support the features that busybox requires and that /proc usually
 	    provides.  To enable this, turn on BB_FEATURE_USE_DEVPS_PATCH and
 	    patch your kernel with the devps patch in the kernel-patches/
 	    directory. 
 	* Wrote basename, dirname, killall, and uptime.
 	* tar has been completely rewritten by me.  Both tar creation and 
 	    extraction are now well behaved.  Costs 7.6k with all optional
 	    tar features enabled, and 5k for just tar extraction support. 
 	* Added freeramdisk, which will free up all memory associated
 	    with a ram disk.  Contributed by Emanuele Caratti <wiz@iol.it>
 	    and then adjusted a bit by me.
 	* Added tr from John Lombardo <john@deltanet.com> 
 	* Added echo and test (from me).
 	* Added usleep contributed by Nicolas Pitre <nico@cam.org>
 	* BusyBox's bss size has been majorly reduced (was 384668, is now 28740).
 	* Several fixes from Pavel Roskin <proski@gnu.org>:
 	    - When `tail' fails to open a file it now exits.
 	    - When `syslogd' is given the `-n' option it should still use 
 		fork() for running klogd.
 	* nslookup types are now changed to u_int32_t (instead of uint32_t)
 	    changed per a patch from Pascal Bellard <pascal.bellard@ascend.com>
 	* Fixed "du" so it gives the same answers as GNU "du" (busybox du used 
 	    to count hard-linked files more then once).  Many thanks to 
 	    Friedrich Vedder <fwv@myrtle.lahn.de> for the fix.
 	* Removed /proc dependancies for init and free (while maintaining 
 	    exactly the same functionality).  /proc takes up 90k of kernel 
 	    space, so it is nice to avoid using it at all costs.
 	* init no longer tries to mount /proc (unless there is less the 1 meg 
 	    free).  Use of /proc (or not) is policy that should be set up in 
 	    /etc/fstab (or in hardcoded scripts), not in init.
 	* Fixed rebooting when init runs as an initrd.
 	* Fixes and updates from Karl M. Hegbloom  <karlheg@debian.org>
 	    - update.c rewritten to look more like update-2.11
 	    - moveed the inode hash out of du.c and into utility.c to make 
 		it a common resource that can be used by other apps.
 	    - cp_mv.c now checks inodes to see if a source and dest are
 		the same, and prints an error (instead of endlessly looping).
 	    - mv now attempts to do a rename, and will fall back to doing
 		a copy only if the rename fails.
 	    - Syslogd now supports multiple concurrent connections
 	* Several fixes from Pavel Roskin <proski@gnu.org>:
 	    - Fixes to sort.  Removed "-g", fixed and added "-r"
 	    - Fixes to the makefile for handling "strip"
 	* An initial telnet implementation was added by 
 	    Randolph Chung <tausq@debian.org>.
 	* Fixed a bug where "sed 's/foo/bar/g'" (i.e. a script w/o a "-e")
 	* ps now supports BB_FEATURE_AUTOWIDTH, and can adjust its width
 	    to match the terminal (defaults to width=79 when this is off).
 	* ps now accepts (and ignores) all options except for "--help" (which
 		as would be expected displays help).
 	* Fixed mount'ing loop devices when the filesystem type was not 
 	    specified.  It used to revert to non-loop after the first try.
 	* all mallocs now use xmalloc (and so are OOM error safe), and
 	    the common error handling saves a few bytes.  Thanks to 
 	    Bob Tinsley <bob@earthrise.demon.co.uk> for the patch.
 	* Fix "+" parsing bug in date, from "Merle F. McClelland" <mfm@cts.com>.
 	* Fix symlink following bug in chmod -R and friends.  
 	* Now allows SYSV style 'chown foo:bar' in addition to 'chown foo.bar'
 	* Fixed a bug in the busybox globbing routine such that 'find /dir -name [i]' 
 	    no longer segfaults.
 
 
 	-Erik Andersen
 
 
 0.42
 
         * Fairly massive restructuring of umount.c to deal with remounting 
 	  busy devices read-only. Adds a -r option to control that; it is 
 	  optionally compiled in with BB_FEATURE_REMOUNT
 	* Added a bunch of functions to mtab.c to interact with the
 	  {get,set,end}mntent interface; as it turns out, those functions do
 	  not appear to be re-entrant, and that causes a lot of problems with
 	  the way umount was originally written.
 	* Makes init send TERM and KILL (instead of HUP and KILL) on reboot
 	  to be more consistent with sysvinit
 	* Changes to init.c to use the new -r option to umount. Also increased
 	  the sleep time between the time the TERM and KILL signals are sent
 
         - Randolph Chung
 
 
 	* cp.c, mv.c: removed, replaced by cp_mv.c which has been
 	    extensively rewritten from the original cp.c.
 	* Fixed cp and mv so if the source and destination are a the
 	    same directory it will print an error and continue.
 	* Also added a warning message to the `mv' usage string saying that
 	    this is not GNU mv, and it will break hard links. cp also breaks
 	    hard links.
 	* ln.c: implemented `-n' switch, no-deref symlinks.
 	* include<sys/param.h>: and use PATH_MAX everywhere.  busybox: File
 	* name buffer overrun guards to prevent future crashes.
 	    - Always check exit status.
 	    - Purge all use of `creat()', replace with `open()'.
 	* utility.c 
 	    - recursiveAction was overriding the value of followLinks thus
 	      ignoring it.
 	    - isDirectory now takes a followLinks boolean, updated all callers
 	    - copyFile had the followLinks logic reversed.
 	* messages.c: New file. Put common error message strings all in
 	    one place in an attempt to shrink the binary a little.
 
 	-Karl M. Hegbloom
 
 
 	* changed fsck_minix.c to reduce its .bss size significantly
 	  -beppu -piptigger
 	* Made tar creation support in busybox tar optional.  You no longer
 	* _have_ to put a "-" in front of tar options.  Tar could inadvertently
 	* change permissions and ownership on
 	    certain directories pointed to by symlinks.
 	* Made grep and grep -h do the right thing wrt printing
 	    the file name (it failed to print files names in many cases).
 	* Fix a namespace aliasing problem wereby if du was built in, the 
 	    symlink for both du and dutmp would be installed, or then rm was
 	    built in, the symlinks for both rm and rmmod would be installed.
 	* Added a closelog() to init.c after loging -- fix thanks to 
 	    Taketoshi Sano <kgh12351@nifty.ne.jp>
 	* Rewrote and simplified logger.  Added the "-t" option, and made it
 	    behave itself a bit better.
 	* Optional support contributed by Ben Collins <bcollins@debian.org> 
 	    for the kernel init chroot patch by Werner Almesberger, which
 	    allows init to chroot to a new device, and umount the old one.
 	* Fixed bug that wouldn't let one chown a symlink -- it would
 	    always dereference before.  -beppu
 	* Fixed a bug where init could have reference already freed memory.
 	    Found and fixed by Taketoshi Sano <kgh12351@nifty.ne.jp>
 	* Several contributions from Friedrich Vedder <fwv@myrtle.lahn.de>
 	* Added (and documented) "-n" option for head
 	* Cleanup for a number of usage messages -- also 
 	    contributed Friedrich Vedder <fwv@myrtle.lahn.de>
 	* Cosmetic fix to busybox.c (Don't print a comma at the
 	    end of line if there are no more application names).
 	* Fixed a stupid bug in "head" option handling ("head -n" 
 	    would segfault).
 	* Moved commonly used functions "xmalloc()" and "exit()"
 	    to utility.c (with proper #ifdef's).
 	* Created a tiny tail implementation, removing -c, -q, -v, and making
 	    tail -f work only with a single file.  This reduced tail from 6k to
 	    2.4k.  The bigger/more featured tail can still be had by disabling
 	    BB_FEATURE_SIMPLE_TAIL in busybox.defs.h
 	* Ping now falls back to doing the right thing if /etc/protocols
 	    turns up missing.
 	* Fixed mount and umount.  Previously they could leak loop device 
 	    allocations, causing the system to quickly run out.  Fix for umount
 	    by Ben Collins <bcollins@debian.org>, and mount was fixed by me.
 	* ls formatting on eight charactor user names fixed by 
 	    Randolph Chung <tausq@debian.org>.
 	* cp could, when copying symlinks, change permissions of the
 	    files pointed to by the symlinks.
 	* Several fixes from Pavel Roskin <proski@gnu.org>:
 	    - `chown' with 1 argument displayed the error incorrectly
 	    - `fdflush', `length' and `printf' crashed if run without arguments
 	    - `fdflush' tried to flush itself using *argv
 	    - added "skip" and "seek" to dd.
 	    - ls no longer messus up output when combining files and
 	      directories on the command line 
 	* swapoff -a was not working.  Now it is.  
 	* init did not cleanly unmount filesystems on reboot.  Now it does.  
 	* "sed -ne s/foo/bar/" worked but "sed -n -e s/foo/bar/" didn't.
 	    Now both work.
 	* Some architectures (PowerPc) assume chars are unsigned, so they could
 	    not distinguish between EOF and '\0xFF' in sed.  Sed now uses ints.
 	* Began converting error handling to use some common routines
 	    in utility.c
 	* syslogd now has better message handling and ignores SIGHUP.
 	* install.sh had a bug preventing installation to the specified
 	    target directory.  Fix from Gilbert Coville <gilbert@mvista.com>
 	* You can now spefify alternative strip commands -- change 
 	    also from Gilbert Coville.
 
 
 	-Erik Andersen
 
 0.41
 	* New Apps: wc, hostid, logname, tty, whoami, yes -- all contributed 
 	    by Edward Betts <edward@debian.org>
 	* Fixed a bug in both cp and mv preventing 'cp foo/README bar'
 	    type commands (file in a directory to another directory) from
 	    working.
 	* Fixed a logger bug that caused garbage to be written to the syslog 
 	    (unless you used busybox syslog, which hid the bug).  Thanks to
 	    Alex Holden <alex@linuxhacker.org> for the fix.
 	* /bin/true and /bin/false were echoing a blank line when run.  
 	    Now fixed.
 	* mkdir -p would print an error when asked to mkdir an existing dir
 	    with no interveining subdirectories.
 	* Fixed "syslogd -O" so that it works.  Added -o loop option for mount,
 	* and support in umount for loop
 	  devices. Support is toggled by MOUNT_LOOP feature -- Ben Collins
 	  <bcollins@debian.org>
 	* Several fixes from Marco Pantaleoni <panta@prosa.it> compile in
 	* fullWrite() not only if BB_TAR is defined, but also
 		if BB_CP or BB_MV are (fullWrite() is referenced by copyFile())
 	    * add some compiler optimizations to further reduce executable size
 		(as a side note, on my machines the largest code is generated
 		by gcc 2.95.2 with -Os ! The smallest by plain gcc 2.7.2.3 with
 		-O2 -m386 ...)
 	    * Compile now won't fail if busybox.def.h defines 
 		BB_FEATURE_LINUXRC but not BB_INIT.  (init_main used to be
 		referenced, but not compiled)
 	* Fixed a bug in setting TERM for serial console support.  TERM now
 	    defaults to "ansi" for serial consoles.
 	* Fixed a bug in handling the CONSOLE env. variable for serial
 	* consoles.
 
 	-Erik Andersen, Jan 15, 2000
 
 0.40
 	* New Apps: sort, uniq. -beppu New Apps: lsmod, rmmod -erik New Apps:
 	* fbset contributed by Randolph Chung <tausq@debian.org>.  New App::
 	* loadacm contributed by Peter Novodvorsky <petya@logic.ru>
 	    for loading application character maps for Unicode fonts.
 	* Major init re-work.  init now supports inittab (slightly different
 	    but similar to sysvinit), allowing me to get all the policy out of
 	    init and into the conf file.  It works just fine without inittab
 	    being present, but if you dont like the defautl behavior you can
 	    now do something about it.  Init is much cleaner as a result.
 	* Fixed an bug in syslogd causing it to stop after 20 minutes. -erik
 	* Fixed an embarrasing segfault in head	-beppu Fixed the embarrasing
 	* failure of 'logger -p'. -erik Added the -s option to du -beppu
 	* Re-worked the source tree a bit so it will compile under glibc 2.0.7 
 	    with the 2.0.x Linux kernel.
 	* Added 'grep -q' thanks to a patch from "Konstantin Boldyshev" 
 	    <konst@voshod.com>.
 	* Grep -i previously failed on UPPER CASE patterns due to a silly 
 	    regexp implementation bug that is now fixed.
 	* Fixed a bug where tar would set, and then clear SGID and SUID bits.
 	* Fixed a bug where tar would not set the user and group on device
 	    special files.
 	* Fixed a bug where tar would not restore the time to files.  Fixed a
 	* major security problem with tar -- it changed ownership 
 	    of any file pointed to by a symlink to 777 (like say libc....)
 	    Ouch!!!
 	* cp and mv were very broken when moving directories.  I have rewritten 
 	    them so they should now work as expected. 
 	* sed now supports addresses (numeric or regexp, with negation) and 
 	    has an append command, thanks to Marco Pantaleoni <panta@prosa.it>
 	* Fixed dmesg.  It wasn't parsing its options (-n or -s) properly.
 	* Some cosmetic fixes to ls output formatting to make it behave more
 	    like GNU ls.
 	* Fixed a stupid segfault in kill.  Several fixes from Friedrich Vedder
 	* <fwv@myrtle.lahn.de>:
 	    - Added gunzip -t, removed gunzip.c dead code,
 	    - fixed several typos
 	    - Glibc 2.0.7 and libc5 compile fixes
 	* Fixed a bug where 'mknod --help' would segfault.
 	    
 
 	-Erik Andersen, Jan 07, 2000
 
 0.39 
 	* New Apps: ping, hostname, and mkfifo contributed by Randolph Chung
 	    <tausq@debian.org>.  3 items off the TODO list!
 	* I wrote free (just calls "cat /proc/meminfo").  Added tail, based on
 	* tail from GNU textutils-1.19, but adjusted
 	    to suit my evil purposes.  Costs 6k.  I'll make it smaller
 	    sometime.
 	* on reboot, init called 'umount -a -n', which caused errors
 	    when BB_MTAB was not enabled.  Changed to 'umount -a', which does
 	    the right thing.
 	* init will now try to run /sbin/getty if it is present (for easy
 	    integration with the about-to-be-released tinylogin.)
 	* kill now behaves itself properly, added 'kill -l' to list signals 'ls
 	* -l' was failing on long directories, since my_getid was leaking 
 	    one file descriptor per file.  Oops.
 	* Fixed rebooting from init.  I'd accidently left some debugging code
 	* in
 	    which blocked reboots.
 	* Fixed reboot, halt (and added poweroff) such that they handle it when
 	    init is not at PID 1 (like when running in an initrd).
 	* Added a prelinary du implementation.  Some parameter parsing
 	    stuff still needs to be added. -beppu (John Beppu
 	    <beppu@lineo.com>)
 	* Implemented tee.  -beppu Implemented head. -beppu
 
 	-Erik Andersen, Dec 10, 1999
 
 0.38
 	* Fixed a segfault in 'umount -a' when a badly formed /etc/fstab
 	    file existed.
 	* df will not exit on error, but will stat all mounted filesystems.
 	* Fixed tar so uid/gid/permissions on extracted tarballs will be 
 	    correct.
 	* Fixed find -name so it properly uses shell wildcard patterns 
 	    (i.e. `*', `?', and `[]') instead of regular expressions, which
 	    was causing some confusing and unexpected behavior.
 	* Added klogd to syslogd, so now the log will contain both system and
 	    kernel messages.
 	* syslogd now creates the /dev/log socket to make sure it is there, and
 	    is actually a socket with the right permissions.
 	* I've taken a first step to making busybox not need the /proc 
 	    filesystem.  Most apps don't need it.  Those that _require_ it, 
 	    will complain if you enable them when you disable 
 	    BB_FEATURE_USE_PROCFS.
 	   
 	-Erik Andersen, Dec 5, 1999
 
 0.37
 	* Wrote a micro syslogd, and a logger util (to log things to the syslog
 	    from the command line or scripts)  With both compiled in, costs 4k.
 	* Fixed 'make install' so symlinks are installed in their proper
 	* locations.  Changed the build system slightly so that features can
 	* now be enabled
 	    or disabled from the busybox.defs.h header file, without trying to
 	    compile in a source file named after that featue (unless that file
 	    exists).
 	* Several options are now moved into busybox.defs.h Now 'rm -R' and 'rm
 	* -r' both work.  dd now properly handles input beyond 1 block from
 	* stdin.  Fixed a bug where tar unpacked everything a directories.
 	* Moved some code 
 	    from createPath into mkdir where it belonged, thereby making tar
 	    work properly.
 	* Fixed an off-by-one bug in cat.  Given a list of file it wouldn't cat
 	* out the
 	    last file in the list.
 	* Fixed 'ls -ln' so numeric group/uid are presented properly, and fixed
 	* 'ls -l' 
 	    so when uid/gid is not in /etc/{passwd,group} the numeric group/uid
 	    are presented properly.  
 	* Also added a TODO.
 
 
 	-Erik Andersen, Nov 25, 1999
 
 0.36
 	* fixed dd so it properly defaults to stdin and stdout when no 
 	    if= and of= are set (fix thanks to Eric Delaunay).
 	* Don't try to close the file descriptor of a pipein tar. (fix also
 	* from
 	    Eric Delaunay).
 	* Made createPath be quiet (again thanks to Eric Delaunay).  If
 	* BB_CONSOLE_CMD_IF_RC_SCRIPT_EXITS is defined, then whatever
 	    command you define it as will be run if the init script exits.
 	* Updated install.sh to make it more robust (thanks to Adam Di Carlo)
 	* NFS support added to mount by Eric Delaunay.  It costs 10k when
 	* compiled
 	    in, but that is still a big win for those that use NFS.
 	* Made 'rm -f' be silent for non-existant files (thanks to Eric
 	* Delaunay).  changed zcat.c to gunzip.c.  It now obeys the principle
 	* of least surprise 
 	    and acts as god intended gunzip and zcat to act.  They answer
 	    --help and obey the '-c' flag.
 	* Fixed a bug in mv which caused it to not move files when the
 	* destination
 	    was a directory.
 	* Fixed a decimal-instead-of-octal bug causing mkdir to make
 	* directories
 	    with very wrong permissions.
 	* chmod would overwrite file permissions instead of modifying them.
 	    Now it properly modifies permissions.
 	* Init now sends warnings destined for the console to /dev/console to
 	* ensure
 	    they show up on whatever the active console it.  Otherwise
 	    important messages (for example that the system is rebooting) were
 	    not seen when switched to a different VT.
 
 	-Erik Andersen, Nov 17, 1999
 	
 0.35
 	* gzip now obeys the principle of least surprise and acts like god
 	* intended 
 	    (i.e. it accepts a file name, answers --help, and obeys the '-c'
 	    flag and only then outputs to stdout).
 	* Fixed more.c to compile autowidth on sparc and set initial winsize 
 	    to 0,0 in case the TIOCGWINSZ ioctl fails.  Fix thanks to Eric
 	    Delaunay.
 	* Fixed tar so it now works as expected (it had TRUE/FALSE backwards)
 	* tar now accepts --help chmod, chown, and chgrp usage now works
 	* General usage (i.e. --help) cleanups for most apps umount now parses
 	* options correctly tar can now unpack tarballs containing device
 	* special files, 
 	    sockets, and fifos (though it can't pack them up) thanks to Matt
 	    Porter.  Creating archives containing these is still left to the
 	    interested student.
 	* fixed up the license in more.c to properly point to Bruce Perens.
 
 	-Erik Andersen, Nov  11, 1999
 
 0.34
 	* ls -l now displays link names outside the current directory,
 	    Patch thanks to Eric Delaunay
 	* init now properly handles sparc serial consoles and does a
 	    better job of finding the real console device rather than using
 	    /dev/console which doesn't support job control. Patch also thanks
 	    to Eric Delaunay.
 	* more started to read from stdin after the last file was finished, and 
 	    options were not parsed correctly (fix thanks to Eric Delaunay).
 	* more will now use the terminal size if BB_FEATURE_AUTOWIDTH is on.
 	* rm wouldn't remove a symlink unless the symlink was valid.  This was
 	    a side effect of the busybox 0.32 recursiveAction() fix.  Things
 	    should now work correctly.
 	* grep wouldn't grep stdin.  Now it does.  sed wouldn't sed stdin.  Now
 	* it does.  sed was appending a \n to the end of lines with
 	* replacements.
 	    Now it doesn't do that.
 	* ls -l now bypasses libc6 nss when displaying user/group names.
 	    Now uses my_getpwuid and my_getgrgid.
 
 	 -Erik Andersen, Nov  8, 1999
 
 0.33
 	* Fixed a bug where init could hang instead of rebooting.
 	* Removed some debugging noise from init.c
 	* Fixed ln so it works now (it was very broken).
 	* Fixed df so it won't segfault when there is no /etc/fstab,
 	* If BB_MTAB is not defined, df and mount will whine if /etc/fstab
 	    is not installed (since they cannot fixup "/dev/root" to 
 	    state the real root device name)
 	* merged some redundant code from mtab.c/df.c into utility.c
 
 	 -Erik Andersen, Nov  5, 1999
 
 0.32
 	* More changes -- many thanks to Lineo for paying me to work on
 	    busybox.  If you have any problems please let me know ASAP at
 	    andersen@lineo.com or andersee@debian.org
 	* usage() now prints the BusyBox version.  This will help folks
 	    realize that they are not in Kansas anymore.
 	* Fixed mkdir -m option so that it works.  kill segfaulted w/o any
 	* arguments.  Now it doesn't do that.  kill wasn't properly accepting
 	* signal names.  It does now.  Added new apps chvt and deallocvt (I
 	* should probably add open) Major rewrite of init.c.  Code is now
 	* readable by mere mortals IMHO.  Wrote sed -- weighs only 1.8k (5.8k
 	* with full regular expressions!).  Fixed a stupid seg-fault in sync
 	* Fixed mount -- mount -a failed to parse and apply mount options Fixed
 	* umount -n (patch thanks to Matthew Grant <grantma@anathoth.gen.nz>)
 	* umount -a no longer umounts /proc Added BB_MTAB, allowing (at the
 	* cost of ~1.5k and the need for a rw /etc)
 	    folks to use a real /etc/mtab file instead of a symlink to
 	    /proc/mounts.  mount, and umount will add/remove entries and df
 	    will now use /etc/mtab if BB_MTAB is defined. 
 	* Fixed a nice bug in recursiveAction() which caused it to infinitely
 	    hunt through /proc/../fd/* creating new file descriptors if it
 	    followed the /dev/fd link over to /proc.  recursiveAction() now
 	    lstat's the file when followLinks==FALSE so it won't follow links
 	    as the name suggests.  Fix thanks to Matt Porter
 	    <porter@debian.org>.
 
 
 	 -Erik Andersen, Nov  4, 1999
 
 0.31
 	* I added a changelog for version 0.30.  adjusted find internals to
 	* make it smaller, and removed 
 	    some redundancy.
 	* Fixed a segfault in ps when /etc/passwd or /etc/group 
 	    are absent.  Now will warn you and carry on.
 	* Added in optional _real_ regular expression support (to be
 	    the basis for a future sed utility).  When compiled in it adds
 	    3.9k, but makes grep much more capable.
 	* Checked out using nftw(3) for recursive stuff, but unfortunatly
 	    it wasn't supported before GNU libc 2.1, and some folks use glibc
 	    2.0.7 since it is much smaller than that latest and greatest.
 
 	 -Erik Andersen, Oct 21, 1999
 
 0.30
 	Major changes -- lots of stuff rewritten. Many thanks to Lineo for
 	paying me to make these updates. If you have any problems with busybox, 
 	or notice any bugs -- please let me know so I can fix it.  These 
 	changes include:
 
 	Core Changes:
 	    * busybox can now invoke apps in two ways: via symlinks to the
 		busybox binary, and as 'busybox [function] [arguments]...'
 	    * When invoked as busybox, the list of currently compiled in 
 		functions is printed out (no this is not bloat -- the list has
 		to be there anyway to map invocation name to function).
 	    * busybox no longer parses command lines for apps or displays their
 		usage info.  Each app gets to handle (or not handle) this for
 		itself.
 	    * Eliminated monadic, dyadic, descend, block_device, and 
 		postprocess.  It was cumbersome to have so many programs
 		cobbled together in this way.  Without them, the app is much
 		more granular.
 	    * All shared code now lives in utility.c, and is properly
 		ifdef'ed to be only included for those apps requiring it.
 	    * Eliminated struct FileInfo (the basis of monadic, dyadic, etc)
 		so now each app has the function prototype of (da-dum): extern
 		int foo_main(int argc, char** argv); which speeds integration
 		of new apps.
 	    * Adjusted the Makefile to make it easier to 
 		{en|dis}able debugging.
 	    * Changed default compiler optimization to -Os 
 		(optimize for smaller binaries).
 
 	App Changes:
 	    * To cope with the new app function prototype and the removal of
 		monadic, dyadic, etc, the following apps were re-written:
 		    * cat - Works same as always.  chgrp, chmod, chown -
 		    * rewrite.  Combined into a single 
 			source file.  Absorbed patches from Enrique Zanardi
 			<ezanard@debian.org> that removes the dependency on
 			libc6 libnss* libraries.
 		    * cp - Can now do 'cp -a' can can copy devices,
 			pipes, symlinks, as well as recursive or non-recursive
 			dir copies.
 		    * fdflush - adjusted to remove dependancy on struct
 		    * FileInfo.  find - Now includes some basic regexp matching 
 			which will be the basic of a future mini-sed.
 		    * ln - Same functionality.  mkdir - Added -p flag to
 		    * feature set.  mv - rewrite.  rm - Added -f flag to
 		    * feature set.  rmdir - Same functionality.  swapon,
 		    * swapoff - Combined into a single binary. No longer
 			uses /etc/swaps.  swap{on|off} -a uses /etc/fstab
 			instead.
 		    * touch - Same functionality.  date - adjusted with a patch
 		    * from Matthew Grant <grantma@anathoth.gen.nz>
 		to accomodate glibc timezone support.  I then ripped out GNU
 		getopt.
 	    * mkswap -- new version merged from util-linux.  Can now make 
 			>128Meg swaps.  
 		* Replaced the old and star, unstar, and tarcat with the tar 
 			implementation from sash.   Now tar behaves as god intended it
 			to (i.e. tar -xvf <file> and tar -cf <file> <dir> work).
 	    * dd -- rewritten.  Can with with files, stdin, stdout.  Added the
 	    * following new apps: loadfont -- added from debian boot floppies
 	    * chroot -- added based on a patch from Paolo Molaro
 	    * <lupus@lettere.unipd.it> grep -- I just wrote it.  Only matches
 	    * simple strings ps -- I just wrote it.  Has _no_ options at all,
 	    * but works.  fsck_minix, mkfs_minix -- added from util-linux, but
 	    * I ripped out
 			internationalization and such to make them smaller.
 		    * sfdisk -- Added from util-linux (minus
 		    * internationalization and such).  Probably some other
 		    * changes that I forgot to document...
 
 	 -Erik Andersen, Oct 20, 1999
 
 0.29	
 	This version was a messy pre-alpha.  stay away or it will bite you.
 	 -Erik Andersen, Sep 24, 1999
 	
 0.28	
 	mini-netcat (mnc) rewritten.
 	
 0.27
 	Mount now supports -a, and -t auto.
 	Mount now updates mtab correctly for 'ro'.
 	More checks screen rows size, outputs bytes percentage.
 	Printf added as module.
 0.26
 	Touch now creates files. -c option for no create.
 	
diff --git a/Config.h b/Config.h
new file mode 100644
index 0000000..a376dee
--- /dev/null
+++ b/Config.h
@@ -0,0 +1,330 @@
+/* vi: set sw=4 ts=4: */
+// This file defines the feature set to be compiled into busybox.
+// When you turn things off here, they won't be compiled in at all.
+//
+//// This file is parsed by sed. You MUST use single line comments.
+//   i.e.  //#define BB_BLAH
+//
+//
+// BusyBox Applications
+#define BB_AR
+#define BB_BASENAME
+#define BB_CAT
+#define BB_CHMOD_CHOWN_CHGRP
+#define BB_CHROOT
+#define BB_CHVT
+#define BB_CLEAR
+#define BB_CP_MV
+#define BB_CUT
+#define BB_DATE
+#define BB_DC
+#define BB_DD
+#define BB_DEALLOCVT
+#define BB_DF
+#define BB_DIRNAME
+#define BB_DMESG
+#define BB_DOS2UNIX
+#define BB_DUTMP
+#define BB_DU
+#define BB_DUMPKMAP
+#define BB_ECHO
+#define BB_EXPR
+#define BB_FBSET
+#define BB_FDFLUSH
+#define BB_FIND
+#define BB_FREE
+#define BB_FREERAMDISK
+#define BB_FSCK_MINIX
+#define BB_GETOPT
+#define BB_GREP
+#define BB_GUNZIP
+#define BB_GZIP
+#define BB_HALT
+#define BB_HEAD
+#define BB_HOSTID
+#define BB_HOSTNAME
+#define BB_ID
+#define BB_INIT
+#define BB_INSMOD
+#define BB_KILL
+#define BB_KILLALL
+#define BB_LENGTH
+#define BB_LN
+#define BB_LOADACM
+#define BB_LOADFONT
+#define BB_LOADKMAP
+#define BB_LOGGER
+#define BB_LOGNAME
+#define BB_LS
+#define BB_LSMOD
+#define BB_MAKEDEVS
+#define BB_MD5SUM
+#define BB_MKDIR
+#define BB_MKFIFO
+#define BB_MKFS_MINIX
+#define BB_MKNOD
+#define BB_MKSWAP
+#define BB_MKTEMP
+#define BB_NC
+#define BB_MORE
+#define BB_MOUNT
+#define BB_MT
+#define BB_NSLOOKUP
+#define BB_PING
+#define BB_POWEROFF
+#define BB_PRINTF
+#define BB_PS
+#define BB_PWD
+#define BB_RDATE
+#define BB_REBOOT
+#define BB_RENICE
+#define BB_RESET
+#define BB_RM
+#define BB_RMDIR
+#define BB_RMMOD
+#define BB_SED
+#define BB_SETKEYCODES
+#define BB_SH
+#define BB_SLEEP
+#define BB_SORT
+#define BB_SWAPONOFF
+#define BB_SYNC
+#define BB_SYSLOGD
+#define BB_TAIL
+#define BB_TAR
+#define BB_TEE
+#define BB_TEST
+#define BB_TELNET
+#define BB_TOUCH
+#define BB_TR
+#define BB_TRUE_FALSE
+#define BB_TTY
+#define BB_UNRPM
+#define BB_UPTIME
+#define BB_USLEEP
+#define BB_WC
+#define BB_WGET
+#define BB_WHICH
+#define BB_WHOAMI
+#define BB_UUENCODE
+#define BB_UUDECODE
+#define BB_UMOUNT
+#define BB_UNIQ
+#define BB_UNAME
+#define BB_UNIX2DOS
+#define BB_UPDATE
+#define BB_XARGS
+#define BB_YES
+// End of Applications List
+//
+//
+//
+// ---------------------------------------------------------
+// This is where feature definitions go.  Generally speaking,
+// turning this stuff off makes things a bit smaller (and less 
+// pretty/useful).
+//
+//
+//
+// Turn this on to use Erik's very cool devps, devmtab, etc kernel drivers,
+// thereby eliminating the need for the /proc filesystem and thereby saving
+// lots and lots memory for more important things.  You can not use this and
+// USE_PROCFS at the same time...  NOTE:  If you enable this feature, you
+// _must_ have patched the kernel to include the devps patch that is included
+// in the busybox/kernel-patches directory.  You will also need to create some
+// device special files in /dev on your embedded system:
+//        mknod /dev/modules c 10 23
+//        mknod /dev/mtab c 10 22
+//        mknod /dev/ps c 10 21
+// I emailed Linus and this patch will not be going into the stock kernel.
+//#define BB_FEATURE_USE_DEVPS_PATCH
+//
+// enable features that use the /proc filesystem (apps that 
+// break without this will tell you on compile)...
+// You can't use this and BB_FEATURE_USE_DEVPS_PATCH 
+// at the same time...
+#define BB_FEATURE_USE_PROCFS
+//
+// This compiles out everything but the most 
+// trivial --help usage information (i.e. reduces binary size)
+//#define BB_FEATURE_TRIVIAL_HELP
+//
+// Use termios to manipulate the screen ('more' is prettier with this on)
+#define BB_FEATURE_USE_TERMIOS
+//
+// calculate terminal & column widths (for more and ls)
+#define BB_FEATURE_AUTOWIDTH
+//
+// show username/groupnames (bypasses libc6 NSS) for ls
+#define BB_FEATURE_LS_USERNAME
+//
+// show file timestamps in ls
+#define BB_FEATURE_LS_TIMESTAMPS
+//
+// enable ls -p and -F
+#define BB_FEATURE_LS_FILETYPES
+//
+// sort the file names (still a bit buggy)
+#define BB_FEATURE_LS_SORTFILES
+//
+// enable ls -R
+#define BB_FEATURE_LS_RECURSIVE
+//
+// enable ls -L
+#define BB_FEATURE_LS_FOLLOWLINKS
+//
+// Change ping implementation -- simplified, featureless, but really small.
+//#define BB_FEATURE_SIMPLE_PING
+//
+// Make init use a simplified /etc/inittab file (recommended).
+#define BB_FEATURE_USE_INITTAB
+//
+//Enable init being called as /linuxrc
+#define BB_FEATURE_LINUXRC
+//
+//Have init enable core dumping for child processes (for debugging only) 
+//#define BB_FEATURE_INIT_COREDUMPS
+//
+// Allow init to permenently chroot, and umount the old root fs
+// just like an initrd does.  Requires a kernel patch by Werner Almesberger. 
+// ftp://icaftp.epfl.ch/pub/people/almesber/misc/umount-root-*.tar.gz
+//#define BB_FEATURE_INIT_CHROOT
+//
+//Make sure nothing is printed to the console on boot
+#define BB_FEATURE_EXTRA_QUIET
+//
+//Should syslogd also provide klogd support?
+#define BB_FEATURE_KLOGD
+//
+// enable syslogd -R remotehost
+#define BB_FEATURE_REMOTE_LOG
+//
+//Simple tail implementation (2.34k vs 3k for the full one).
+//Both provide 'tail -f' support (only one file at a time.)
+#define BB_FEATURE_SIMPLE_TAIL
+//
+// Enable support for loop devices in mount
+#define BB_FEATURE_MOUNT_LOOP
+//
+// Enable support for a real /etc/mtab file instead of /proc/mounts
+//#define BB_FEATURE_MOUNT_MTAB_SUPPORT
+//
+// Enable support for mounting remote NFS volumes
+#define BB_FEATURE_NFSMOUNT
+//
+// Enable support forced filesystem unmounting 
+// (i.e. in case of an unreachable NFS system).
+#define BB_FEATURE_MOUNT_FORCE
+//
+// Enable support for creation of tar files.
+#define BB_FEATURE_TAR_CREATE
+//
+// Enable support for "--exclude" for excluding files
+#define BB_FEATURE_TAR_EXCLUDE
+//
+// Enable support for s///p pattern matching
+#define BB_FEATURE_SED_PATTERN_SPACE
+//
+//// Enable reverse sort
+#define BB_FEATURE_SORT_REVERSE
+//
+// Enable command line editing in the shell
+#define BB_FEATURE_SH_COMMAND_EDITING
+//
+//Allow the shell to invoke all the compiled in BusyBox commands as if they
+//were shell builtins.  Nice for staticly linking an emergency rescue shell
+//among other thing.
+#define BB_FEATURE_SH_STANDALONE_SHELL
+//
+// Enable tab completion in the shell (not yet 
+// working very well -- so don't turn this on)
+//#define BB_FEATURE_SH_TAB_COMPLETION
+//
+//Turn on extra fbset options
+//#define BB_FEATURE_FBSET_FANCY
+//
+//Turn on fbset readmode support
+//#define BB_FEATURE_FBSET_READMODE
+//
+// You must enable one or both of these features
+// Support installing modules from pre 2.1 kernels
+//#define BB_FEATURE_INSMOD_OLD_KERNEL
+// Support installing modules from kernel versions after 2.1.18
+#define BB_FEATURE_INSMOD_NEW_KERNEL
+//
+// Support module version checking
+//#define BB_FEATURE_INSMOD_VERSION_CHECKING
+//
+// Support for Minix filesystem, version 2
+//#define BB_FEATURE_MINIX2
+//
+//
+// Enable busybox --install [-s]
+// to create links (or symlinks) for all the commands that are 
+// compiled into the binary.  (needs /proc filesystem)
+// #define BB_FEATURE_INSTALLER
+//
+// Clean up all memory before exiting -- usually not needed
+// as the OS can clean up...  Don't enable this unless you
+// have a really good reason for cleaning things up manually.
+//#define BB_FEATURE_CLEAN_UP
+//
+// End of Features List
+//
+//
+//
+//
+//
+//
+//---------------------------------------------------
+// Nothing beyond this point should ever be touched by 
+// mere mortals so leave this stuff alone.
+//
+#ifdef BB_FEATURE_MOUNT_MTAB_SUPPORT
+#define BB_MTAB
+#endif
+//
+#if defined BB_FEATURE_SH_COMMAND_EDITING && defined BB_SH
+#define BB_CMDEDIT
+#endif
+//
+#ifdef BB_KILLALL
+#ifndef BB_KILL
+#define BB_KILL
+#endif
+#endif
+//
+#ifdef BB_FEATURE_LINUXRC
+#ifndef BB_INIT
+#define BB_INIT
+#endif
+#define BB_LINUXRC
+#endif
+//
+#ifdef BB_GZIP
+#ifndef BB_GUNZIP
+#define BB_GUNZIP
+#endif
+#endif
+//
+#if defined BB_MOUNT && defined BB_FEATURE_NFSMOUNT
+#define BB_NFSMOUNT
+#endif
+//
+#if defined BB_FEATURE_SH_COMMAND_EDITING
+#ifndef BB_FEATURE_USE_TERMIOS
+#define BB_FEATURE_USE_TERMIOS
+#endif
+#endif
+//
+#if defined BB_FEATURE_AUTOWIDTH
+#ifndef BB_FEATURE_USE_TERMIOS
+#define BB_FEATURE_USE_TERMIOS
+#endif
+#endif
+//
+#if defined BB_INSMOD
+#ifndef BB_FEATURE_INSMOD_OLD_KERNEL
+#define BB_FEATURE_INSMOD_NEW_KERNEL
+#endif
+#endif
diff --git a/Config.h.Hurd b/Config.h.Hurd
new file mode 100644
index 0000000..60a5c6e
--- /dev/null
+++ b/Config.h.Hurd
@@ -0,0 +1,327 @@
+/* vi: set sw=4 ts=4: */
+
+// NOTE: This file only defines features usefull under the Hurd,
+// To compile for the Hurd raname this to Config.h prior to make
+
+// This file defines the feature set to be compiled into busybox.
+// When you turn things off here, they won't be compiled in at all.
+//
+//// This file is parsed by sed. You MUST use single line comments.
+//   i.e.  //#define BB_BLAH
+//
+//
+// BusyBox Applications
+#define BB_AR
+#define BB_BASENAME
+#define BB_CAT
+#define BB_CHMOD_CHOWN_CHGRP
+#define BB_CHROOT
+//#define BB_CHVT	/* not needed */
+#define BB_CLEAR
+#define BB_CP_MV
+#define BB_CUT
+#define BB_DATE
+#define BB_DC
+#define BB_DD
+//#define BB_DEALLOCVT	/* inot needed */
+//#define BB_DF		/* different implementation */
+#define BB_DIRNAME
+//#define BB_DMESG	/* doesnt compile, different implementation  */
+#define BB_DUTMP
+#define BB_DU
+//#define BB_DUMPKMAP	/* not needed */
+#define BB_ECHO
+#define BB_EXPR
+//#define BB_FBSET	/* not needed, doesnt compile */
+//#define BB_FDFLUSH 	/* is this needed? */
+#define BB_FIND
+//#define BB_FREE	/* doesnt compile */
+#define BB_FREERAMDISK  /* does hurd support ramdisks ? */
+#define BB_FSCK_MINIX
+#define BB_GETOPT
+#define BB_GREP
+#define BB_GUNZIP
+#define BB_GZIP
+#define BB_HALT
+#define BB_HEAD
+#define BB_HOSTID
+#define BB_HOSTNAME
+#define BB_ID
+//#define BB_INIT	/* not needed?, doesnt compile */
+//#define BB_INSMOD	/* not needed, doesnt compile */
+#define BB_KILL
+#define BB_KILLALL
+#define BB_LENGTH
+#define BB_LN
+//#define BB_LOADACM	/* not needed, doesnt compile */
+//#define BB_LOADFONT	/* not needed, doesnt compile */
+//#define BB_LOADKMAP	/* not needed */
+#define BB_LOGGER
+#define BB_LOGNAME
+#define BB_LS
+//#define BB_LSMOD	/* not needed, doesnt compile */
+//#define BB_MAKEDEVS	/* different implementation */
+#define BB_MD5SUM
+#define BB_MKDIR
+#define BB_MKFIFO
+#define BB_MKFS_MINIX
+#define BB_MKNOD
+//#define BB_MKSWAP 	/* different impelementation (i think) */
+#define BB_MKTEMP
+#define BB_NC
+#define BB_MORE
+//#define BB_MOUNT	/* different implementation */
+#define BB_MT
+#define BB_NSLOOKUP
+//#define BB_PING	/* doesnt compile, Hurd uses BSD style ip.h */
+//#define BB_POWEROFF	/* different implementation i assume */
+#define BB_PRINTF
+//#define BB_PS		/* needs /proc */
+#define BB_PWD
+#define BB_RDATE
+//#define BB_REBOOT	/* different implementation */
+#define BB_RENICE
+#define BB_RESET
+#define BB_RM
+#define BB_RMDIR
+//#define BB_RMMOD	/* not needed, doesnt compile */
+#define BB_SED
+//#define BB_SETKEYCODES /* is this needed ? */
+#define BB_SH
+#define BB_SLEEP
+#define BB_SORT
+//#define BB_SWAPONOFF	/* different implementation, doesnt compile */
+#define BB_SYNC
+//#define BB_SYSLOGD 	/* doesnt compile */
+#define BB_TAIL
+#define BB_TAR
+#define BB_TEE
+#define BB_TEST
+#define BB_TELNET
+#define BB_TOUCH
+#define BB_TR
+#define BB_TRUE_FALSE
+#define BB_TTY
+//#define BB_UPTIME 	/* doesnt compile */
+#define BB_USLEEP
+#define BB_WC
+#define BB_WGET
+#define BB_WHICH
+#define BB_WHOAMI
+#define BB_UUENCODE
+#define BB_UUDECODE
+//#define BB_UMOUNT	/* different implementation */
+#define BB_UNIQ
+//#define BB_UNAME	/* doesnt compile */
+//#define BB_UPDATE	/* doesnt compile */
+#define BB_YES
+// End of Applications List
+//
+//
+//
+// ---------------------------------------------------------
+// This is where feature definitions go.  Generally speaking,
+// turning this stuff off makes things a bit smaller (and less 
+// pretty/useful).
+//
+//
+//
+// Turn this on to use Erik's very cool devps, devmtab, etc kernel drivers,
+// thereby eliminating the need for the /proc filesystem and thereby saving
+// lots and lots memory for more important things.  You can not use this and
+// USE_PROCFS at the same time...  NOTE:  If you enable this feature, you
+// _must_ have patched the kernel to include the devps patch that is included
+// in the busybox/kernel-patches directory.  You will also need to create some
+// device special files in /dev on your embedded system:
+//        mknod /dev/modules c 10 23
+//        mknod /dev/mtab c 10 22
+//        mknod /dev/ps c 10 21
+// I emailed Linus and this patch will not be going into the stock kernel.
+//#define BB_FEATURE_USE_DEVPS_PATCH
+//
+// enable features that use the /proc filesystem (apps that 
+// break without this will tell you on compile)...
+// You can't use this and BB_FEATURE_USE_DEVPS_PATCH 
+// at the same time...
+#define BB_FEATURE_USE_PROCFS
+//
+// This compiles out everything but the most 
+// trivial --help usage information (i.e. reduces binary size)
+//#define BB_FEATURE_TRIVIAL_HELP
+//
+// Use termios to manipulate the screen ('more' is prettier with this on)
+#define BB_FEATURE_USE_TERMIOS
+//
+// calculate terminal & column widths (for more and ls)
+#define BB_FEATURE_AUTOWIDTH
+//
+// show username/groupnames (bypasses libc6 NSS) for ls
+#define BB_FEATURE_LS_USERNAME
+//
+// show file timestamps in ls
+#define BB_FEATURE_LS_TIMESTAMPS
+//
+// enable ls -p and -F
+#define BB_FEATURE_LS_FILETYPES
+//
+// sort the file names (still a bit buggy)
+#define BB_FEATURE_LS_SORTFILES
+//
+// enable ls -R
+#define BB_FEATURE_LS_RECURSIVE
+//
+// Change ping implementation -- simplified, featureless, but really small.
+#define BB_FEATURE_SIMPLE_PING
+//
+// Make init use a simplified /etc/inittab file (recommended).
+#define BB_FEATURE_USE_INITTAB
+//
+//Enable init being called as /linuxrc
+//#define BB_FEATURE_LINUXRC
+//
+//Have init enable core dumping for child processes (for debugging only) 
+//#define BB_FEATURE_INIT_COREDUMPS
+//
+// Allow init to permenently chroot, and umount the old root fs
+// just like an initrd does.  Requires a kernel patch by Werner Almesberger. 
+// ftp://icaftp.epfl.ch/pub/people/almesber/misc/umount-root-*.tar.gz
+//#define BB_FEATURE_INIT_CHROOT
+//
+//Make sure nothing is printed to the console on boot
+#define BB_FEATURE_EXTRA_QUIET
+//
+//Should syslogd also provide klogd support?
+#define BB_FEATURE_KLOGD
+//
+// enable syslogd -R remotehost
+#define BB_FEATURE_REMOTE_LOG
+//
+//Simple tail implementation (2.34k vs 3k for the full one).
+//Both provide 'tail -f' support (only one file at a time.)
+#define BB_FEATURE_SIMPLE_TAIL
+//
+// Enable support for loop devices in mount
+//#define BB_FEATURE_MOUNT_LOOP
+//
+// Enable support for a real /etc/mtab file instead of /proc/mounts
+//#define BB_FEATURE_MOUNT_MTAB_SUPPORT
+//
+// Enable support for mounting remote NFS volumes
+//#define BB_FEATURE_NFSMOUNT
+//
+// Enable support forced filesystem unmounting 
+// (i.e. in case of an unreachable NFS system).
+#define BB_FEATURE_MOUNT_FORCE
+//
+// Enable support for creation of tar files.
+#define BB_FEATURE_TAR_CREATE
+//
+// Enable support for "--exclude" for excluding files
+#define BB_FEATURE_TAR_EXCLUDE
+//
+// Enable support for s///p pattern matching
+#define BB_FEATURE_SED_PATTERN_SPACE
+//
+//// Enable reverse sort
+#define BB_FEATURE_SORT_REVERSE
+//
+// Enable command line editing in the shell
+#define BB_FEATURE_SH_COMMAND_EDITING
+//
+//Allow the shell to invoke all the compiled in BusyBox commands as if they
+//were shell builtins.  Nice for staticly linking an emergency rescue shell
+//among other thing.
+#define BB_FEATURE_SH_STANDALONE_SHELL
+//
+// Enable tab completion in the shell (not yet 
+// working very well -- so don't turn this on)
+//#define BB_FEATURE_SH_TAB_COMPLETION
+//
+//Turn on extra fbset options
+//#define BB_FEATURE_FBSET_FANCY
+//
+//Turn on fbset readmode support
+//#define BB_FEATURE_FBSET_READMODE
+//
+// You must enable one or both of these features
+// Support installing modules from pre 2.1 kernels
+//#define BB_FEATURE_INSMOD_OLD_KERNEL
+// Support installing modules from kernel versions after 2.1.18
+#define BB_FEATURE_INSMOD_NEW_KERNEL
+//
+// Support module version checking
+//#define BB_FEATURE_INSMOD_VERSION_CHECKING
+//
+// Support for Minix filesystem, version 2
+//#define BB_FEATURE_MINIX2
+//
+//
+// Enable busybox --install [-s]
+// to create links (or symlinks) for all the commands that are 
+// compiled into the binary.  (needs /proc filesystem)
+// #define BB_FEATURE_INSTALLER
+//
+// Clean up all memory before exiting -- usually not needed
+// as the OS can clean up...  Don't enable this unless you
+// have a really good reason for cleaning things up manually.
+//#define BB_FEATURE_CLEAN_UP
+//
+// End of Features List
+//
+//
+//
+//
+//
+//
+//---------------------------------------------------
+// Nothing beyond this point should ever be touched by 
+// mere mortals so leave this stuff alone.
+//
+#ifdef BB_FEATURE_MOUNT_MTAB_SUPPORT
+#define BB_MTAB
+#endif
+//
+#if defined BB_FEATURE_SH_COMMAND_EDITING && defined BB_SH
+#define BB_CMDEDIT
+#endif
+//
+#ifdef BB_KILLALL
+#ifndef BB_KILL
+#define BB_KILL
+#endif
+#endif
+//
+#ifdef BB_FEATURE_LINUXRC
+#ifndef BB_INIT
+#define BB_INIT
+#endif
+#define BB_LINUXRC
+#endif
+//
+#ifdef BB_GZIP
+#ifndef BB_GUNZIP
+#define BB_GUNZIP
+#endif
+#endif
+//
+#if defined BB_MOUNT && defined BB_FEATURE_NFSMOUNT
+#define BB_NFSMOUNT
+#endif
+//
+#if defined BB_FEATURE_SH_COMMAND_EDITING
+#ifndef BB_FEATURE_USE_TERMIOS
+#define BB_FEATURE_USE_TERMIOS
+#endif
+#endif
+//
+#if defined BB_FEATURE_AUTOWIDTH
+#ifndef BB_FEATURE_USE_TERMIOS
+#define BB_FEATURE_USE_TERMIOS
+#endif
+#endif
+//
+#if defined BB_INSMOD
+#ifndef BB_FEATURE_INSMOD_OLD_KERNEL
+#define BB_FEATURE_INSMOD_NEW_KERNEL
+#endif
+#endif
diff --git a/Makefile b/Makefile
index 15d13c5..4695390 100644
--- a/Makefile
+++ b/Makefile
@@ -1,233 +1,233 @@
 # Makefile for busybox
 #
 # Copyright (C) 1999-2000 Erik Andersen <andersee@debian.org>
 # Copyright (C) 2000 Karl M. Hegbloom <karlheg@debian.org>
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 #
 
 PROG      := busybox
-VERSION   := 0.47pre
+VERSION   := 0.47
 BUILDTIME := $(shell TZ=UTC date --utc "+%Y.%m.%d-%H:%M%z")
 export VERSION
 
 # If you want a static binary, turn this on.
 DOSTATIC = false
 
 # Set the following to `true' to make a debuggable build.
 # Leave this set to `false' for production use.
 # eg: `make DODEBUG=true tests'
 # Do not enable this for production builds...
 DODEBUG = false
 
 # This enables compiling with dmalloc ( http://dmalloc.com/ )
 # which is an excellent public domain mem leak and malloc problem
 # detector.  To enable dmalloc, before running busybox you will
 # want to first set up your environment.
 # eg: `export DMALLOC_OPTIONS=debug=0x14f47d83,inter=100,log=logfile`
 # Do not enable this for production builds...
 DODMALLOC = false
 
 # If you want large file summit support, turn this on.
 # This has no effect if you don't have a kernel with lfs
 # support, and a system with libc-2.1.3 or later.
 # Some of the programs that can benefit from lfs support
 # are dd, gzip, mount, tar, and mkfs_minix.
 # LFS allows you to use the above programs for files
 # larger than 2GB!
 DOLFS = false
 
 
 # If you are running a cross compiler, you may want to set this
 # to something more interesting...
 CROSS = #powerpc-linux-
 CC = $(CROSS)gcc
 STRIPTOOL = $(CROSS)strip
 
 # To compile vs an alternative libc, you may need to use/adjust
 # the following lines to meet your needs.  This is how I make
 # busybox compile with uC-Libc...
 #LIBCDIR=/home/andersen/CVS/uC-libc
 #GCCINCDIR = $(shell gcc -print-search-dirs | sed -ne "s/install: \(.*\)/\1include/gp")
 #CFLAGS+=-nostdinc -fno-builtin -I$(LIBCDIR)/include -I$(GCCINCDIR)
 #LDFLAGS+=-nostdlib
 #LIBRARIES = $(LIBCDIR)/libc.a
 
 #--------------------------------------------------------
 
 # use '-Os' optimization if available, else use -O2
 OPTIMIZATION = $(shell if $(CC) -Os -S -o /dev/null -xc /dev/null >/dev/null 2>&1; \
     then echo "-Os"; else echo "-O2" ; fi)
 
 WARNINGS = -Wall
 
 ifeq ($(DOLFS),true)
     # For large file summit support
     CFLAGS+=-D_FILE_OFFSET_BITS=64
 endif
 ifeq ($(DODMALLOC),true)
     # For testing mem leaks with dmalloc
     CFLAGS+=-DDMALLOC
     LIBRARIES = -ldmalloc
     # Force debug=true, since this is useless when not debugging...
     DODEBUG = true
 endif
 # -D_GNU_SOURCE is needed because environ is used in init.c
 ifeq ($(DODEBUG),true)
     CFLAGS += $(WARNINGS) -g -D_GNU_SOURCE
     LDFLAGS += 
     STRIP   =
 else
     CFLAGS  += $(WARNINGS) $(OPTIMIZATION) -fomit-frame-pointer -D_GNU_SOURCE
     LDFLAGS  += -s
     STRIP    = $(STRIPTOOL) --remove-section=.note --remove-section=.comment $(PROG)
 endif
 ifeq ($(DOSTATIC),true)
     LDFLAGS += --static
     #
     #use '-ffunction-sections -fdata-sections' and '--gc-sections' (if they 
     # work) to try and strip out any unused junk.  Doesn't do much for me, 
     # but you may want to give it a shot...
     #
     #ifeq ($(shell $(CC) -ffunction-sections -fdata-sections -S \
     #	-o /dev/null -xc /dev/null 2>/dev/null && $(LD) \
     #			--gc-sections -v >/dev/null && echo 1),1)
     #	CFLAGS += -ffunction-sections -fdata-sections
     #	LDFLAGS += --gc-sections
     #endif
 endif
 
 ifndef $(PREFIX)
     PREFIX = `pwd`/_install
 endif
 
 OBJECTS   = $(shell ./busybox.sh) busybox.o messages.o usage.o utility.o
 CFLAGS    += -DBB_VER='"$(VERSION)"'
 CFLAGS    += -DBB_BT='"$(BUILDTIME)"'
 ifdef BB_INIT_SCRIPT
     CFLAGS += -DINIT_SCRIPT='"$(BB_INIT_SCRIPT)"'
 endif
 
 
 all: busybox busybox.links doc
 
 doc: olddoc
 
 # Old Docs...
 olddoc: docs/BusyBox.txt docs/BusyBox.1 docs/BusyBox.html
 
 docs/BusyBox.txt: docs/busybox.pod
 	@echo
 	@echo BusyBox Documentation
 	@echo
 	- pod2text docs/busybox.pod > docs/BusyBox.txt
 
 docs/BusyBox.1: docs/busybox.pod
 	- pod2man --center=BusyBox --release="version $(VERSION)" docs/busybox.pod > docs/BusyBox.1
 
 docs/BusyBox.html: docs/busybox.lineo.com/BusyBox.html
 	- rm -f docs/BusyBox.html
 	- ln -s busybox.lineo.com/BusyBox.html docs/BusyBox.html
 
 docs/busybox.lineo.com/BusyBox.html: docs/busybox.pod
 	- pod2html --noindex docs/busybox.pod > docs/busybox.lineo.com/BusyBox.html
 	- rm -f pod2html*
 
 
 # New docs based on DOCBOOK SGML
 newdoc: docs/busybox.txt docs/busybox.pdf docs/busybox/busyboxdocumentation.html
 
 docs/busybox.txt: docs/busybox.sgml
 	@echo
 	@echo BusyBox Documentation
 	@echo
 	(cd docs; sgmltools -b txt busybox.sgml)
 
 docs/busybox.dvi: docs/busybox.sgml
 	(cd docs; sgmltools -b dvi busybox.sgml)
 
 docs/busybox.ps: docs/busybox.sgml
 	(cd docs; sgmltools -b ps busybox.sgml)
 
 docs/busybox.pdf: docs/busybox.ps
 	(cd docs; ps2pdf busybox.ps)
 
 docs/busybox/busyboxdocumentation.html: docs/busybox.sgml
 	(cd docs/busybox.lineo.com; sgmltools -b html ../busybox.sgml)
 
 
 
 busybox: $(OBJECTS) 
 	$(CC) $(LDFLAGS) -o $@ $^ $(LIBRARIES)
 	$(STRIP)
 
-busybox.links: busybox.def.h
+busybox.links: Config.h
 	- ./busybox.mkll | sort >$@
 
 nfsmount.o cmdedit.o: %.o: %.h
-$(OBJECTS): %.o: busybox.def.h internal.h  %.c Makefile
+$(OBJECTS): %.o: Config.h internal.h  %.c Makefile
 
 utility.o: loop.h
 
 loop.h:
 	@./mk_loop_h.sh
 
 test tests:
 	cd tests && $(MAKE) all
 
 clean:
 	cd tests && $(MAKE) clean
 	- rm -f docs/BusyBox.txt docs/BusyBox.1 docs/BusyBox.html \
 	    docs/busybox.lineo.com/BusyBox.html
 	- rm -f docs/busybox.txt docs/busybox.dvi docs/busybox.ps \
 	    docs/busybox.pdf docs/busybox.lineo.com/busybox.html
 	- rm -rf docs/busybox _install
 	- rm -f busybox.links *~ *.o core
 
 distclean: clean
 	- rm -f busybox
 	- cd tests && $(MAKE) distclean
 
 install: busybox busybox.links
 	./install.sh $(PREFIX)
 
 install-hardlinks: busybox busybox.links
 	./install.sh $(PREFIX) --hardlinks
 
 dist release: distclean doc
 	cd ..;					\
 	rm -rf busybox-$(VERSION);		\
 	cp -a busybox busybox-$(VERSION);	\
 						\
 	find busybox-$(VERSION)/ -type d	\
 				 -name CVS	\
 				 -print		\
 		| xargs rm -rf;			\
 						\
 	find busybox-$(VERSION)/ -type f	\
 				 -name .cvsignore \
 				 -print		\
 		| xargs rm -f;			\
 						\
 	find busybox-$(VERSION)/ -type f	\
 				 -name .\#*	\
 				 -print		\
 		| xargs rm -f;			\
 						\
 	tar -cvzf busybox-$(VERSION).tar.gz busybox-$(VERSION)/;
 
 .PHONY: tags
 tags:
 	ctags -R .
diff --git a/README b/README
index 17e7722..8d1845a 100644
--- a/README
+++ b/README
@@ -1,71 +1,71 @@
 Please see the LICENSE file for copyright information.
     
 BusyBox combines tiny versions of many common UNIX utilities into a single
 small executable. It provides minimalist replacements for most of the utilities
 you usually find in fileutils, shellutils, findutils, textutils, grep, gzip,
 tar, etc. BusyBox provides a fairly complete POSIX environment for any small or
 emdedded system. The utilities in BusyBox generally have fewer options then
 their full featured GNU cousins; however, the options that are included provide
 the expected functionality and behave very much like their GNU counterparts.
 
 BusyBox has been written with size-optimization and limited resources in mind.
 It is also extremely modular so you can easily include or exclude commands (or
 features) at compile time. This makes it easy to customize your embedded
 systems. To create a working system, just add a kernel, a shell (such as ash),
 and an editor (such as elvis-tiny or ae).
 
 Busybox was originally written to support the Debian Rescue/Install disks, but
 it also makes an excellent environment for any small or embedded system.
 
 As of version 0.20 there is a version number. : ) Also as of version 0.20,
 BusyBox is now modularized to easily allow you to build only the components you
 need, thereby reducing binary size. To turn off unwanted Busybox components,
-simply edit the file busybox.def.h and comment out the components you do not
+simply edit the file "Config.h" and comment out the components you do not
 need using C++ style (//) comments.
 
 After the build is complete a busybox.links file is generated which is then
 used by 'make install' to create symlinks to the busybox binary for all
 compiled in functions.  By default, 'make install' will place the symlink
 forest into `pwd`/_install unless you have defined the PREFIX environment
 variable (i.e. make PREFIX="/tmp/foo" install)
 
 ----------------
 Getting help:
 When you find you need help, you can check out the BusyBox mailing list
 archives at http://opensource.lineo.com/lists/busybox/ or even join
 the mailing list if you are interested.
 
 ----------------
 Bugs:
 If you find bugs, follow the instructions at http://bugs.lineo.com/Reporting.html
 and submit a bug report.  This way, we can be sure nothing falls through the 
 cracks...
 
 ----------------
 FTP:
 Source for the latest released version can always be downloaded from 
     ftp://ftp.lineo.com/pub/busybox. 
 
 ----------------
 CVS:
 BusyBox now has its own publically browsable CVS tree at:
     http://opensource.lineo.com/cgi-bin/cvsweb/busybox/
 
 Anonymous CVS access is available.  For instructions, check out:
     http://opensource.lineo.com/cvs_anon.html
 
 For those that are actively contributing there is even CVS write access:
     http://opensource.lineo.com/cvs_write.html
 
 
 ----------------
 
 Please feed suggestions, bug reports, insults, and bribes back to:
 	Erik Andersen 
 	<andersen@lineo.com>
 	<andersee@debian.org>
 
 <blatent plug>
 Many thanks to go to Lineo for paying me to work on busybox. 
 </blatent plug>
 
diff --git a/TODO b/TODO
index 6a4dfe3..0756fd0 100644
--- a/TODO
+++ b/TODO
@@ -1,405 +1,57 @@
 TODO list for busybox in no particular order. Just because something
 is listed here doesn't mean that it is going to be added to busybox,
 or that doing so is even a good idea. It just means that I _might_ get
 around to it some time. If you have any good ideas, please let me know.
 
 * login/sulogin/passwd/getty/etc are part of tinylogin, and so are not
     needed or wanted in busybox (or else I'd have to link to libcrypt).
 
 * Networking apps are probably going to be split out some time soon into a
     separate package (named perhaps netkit-tiny?).  This would remove the
-    following items from BusyBox: hostid, hostname, nc, nslookup, telnet, 
-    and ping.  nfs mounting and syslogd (when it supports network logging)
-    will remain in BusyBox.
+    following items from BusyBox: hostid, hostname, nc, nslookup, telnet, and
+    ping.  nfs mounting and syslogd (network logging) will remain in BusyBox.
 
  -Erik
 
 -----------
 
 * dnsdomainname
 * traceroute/netstat
 * hwclock
 * stty
 * tftp
 * ftp
 * group/commonize strings, remove dups (for i18n, l10n)
 
 -----------------------
 
 Running the following:
 
     rm -f busybox && make LDFLAGS+=-nostdlib 2>&1 | \
 	sed -ne 's/.*undefined reference to `\(.*\)..*/\1/gp' | sort | uniq
 
 reveals the list of all external (i.e. libc) things that BusyBox depends on.
 It would be a very nice thing to reduce this list to an absolute minimum, and
 then create a microLibc to provide these functions.  There is no good reason
 for GNU libc to be so big.  I'm sure it can be a lot better.
 
 (BTW, this is more informative if BB_FEATURE_NFSMOUNT is turned off...)
 
 Most wanted list:
 
     [andersen@slag busybox]$ grep -l getgroups *.[ch]
     test.c
 
 Policy violation.  getgroups uses libc nss, which is unlikely
 to be present in an embedded system.
 
 -----------------------
 
 Compile with debugging on, run 'nm --size-sort ./busybox'
 and then start with the biggest things and make them smaller...
 
 -----------------------
 
-
- I think that the add_inode &c in utility.c needs to also stow the
- st_dev field, and that du.c should NOT call `reset_inode_list'
- because there can be hard links from inside one argv/ to inside
- another argv/.  du.c probably ought to have an -x switch like GNU du
- does also...
-
+ du.c probably ought to have an -x switch like GNU du does...
 
 ------------------------------------------------------------------
-
-An interesting email listing some apps that use /proc.  BusyBox
-tries to avoid /proc as mush as is possible, so this stuff is
-interesting (to me at least):
-
-
-Date: 	Fri, 25 Feb 2000 08:23:12 +0000 (GMT)
-From: Riley Williams <rhw@MemAlpha.CX>
-X-Sender: rhw@moo.cus.org.uk
-To: almesber@lrc.di.epfl.ch
-Cc: "Albert D. Cahalan" <acahalan@cs.uml.edu>,
-	Linux Kernel <linux-kernel@vger.rutgers.edu>
-Subject: Re: What /proc should contain [was: /proc/driver/microcode]
-In-Reply-To: <20000224165245.A29790@lrc.di.epfl.ch>
-Message-ID: <Pine.LNX.4.21.0002250806220.8741-100000@moo.cus.org.uk>
-Sender: owner-linux-kernel@vger.rutgers.edu
-Precedence: bulk
-
-Hi there.
-
- >> Nope, most /proc access is does via programs written in C.
-
- > That varies a lot from file to file. E.g. I haven't seen any
- > programs that are specificly designed to read /proc/atm/* yet,
- > and I know of only one (fuser) that reads /proc/mounts,
- > extracting only partial information (just to pick two examples
- > that I'm quite familiar with).
-
-As a point of reference, here's a slightly tweaked analysis of the
-programs on the system I'm reading your mail on. Basically, I ran the
-following script...
-
- Q> #!/bin/bash
- Q> function use() {
- Q>     for Z in $* ; do
- Q>         strings $Z | grep /proc | sed "s=^=$Z ="
- Q>     done
- Q> }
- Q> use /{,s}bin/* /usr/{,s}bin/* | sort -u | tee proc-usage
-
-...and then went through it removing comments and print format
-strings. Replace /proc with /dev and you'd soon have an equivalent
-list for that - although I can report that such is MUCH larger...
-
-There are three programs therein that refer to /proc/mounts ...
-
-	/bin/mount
-	/bin/umount
-	/usr/bin/eject
-
-...and, as you stated, none that refer to /proc/atm on this system.
-However, as this is a RedHat Linux 5.0 based system, that's not
-necessarily an up to date reference thereto...
-
-Here's the list anyway...
-
-/bin/kill /proc/%d/cmdline
-/bin/kill /proc/%d/stat
-
-/bin/mount /proc/devices
-/bin/mount /proc/filesystems
-/bin/mount /proc/mounts
-
-/bin/netstat /proc/net
-/bin/netstat /proc/net/appletalk
-/bin/netstat /proc/net/ax25
-/bin/netstat /proc/net/ax25_route
-/bin/netstat /proc/net/dev
-/bin/netstat /proc/net/ip_masquerade
-/bin/netstat /proc/net/ipx
-/bin/netstat /proc/net/ipx_route
-/bin/netstat /proc/net/netstat
-/bin/netstat /proc/net/nr
-/bin/netstat /proc/net/nr_neigh
-/bin/netstat /proc/net/nr_nodes
-/bin/netstat /proc/net/raw
-/bin/netstat /proc/net/route
-/bin/netstat /proc/net/rt_cache
-/bin/netstat /proc/net/snmp
-/bin/netstat /proc/net/tcp
-/bin/netstat /proc/net/udp
-/bin/netstat /proc/net/unix
-
-/bin/umount /proc/devices
-/bin/umount /proc/mounts
-
-/sbin/arp /proc/net/appletalk
-/sbin/arp /proc/net/arp
-/sbin/arp /proc/net/ax25
-/sbin/arp /proc/net/ipx
-/sbin/arp /proc/net/nr
-/sbin/arp /proc/net/unix
-
-/sbin/cardctl /proc/devices
-
-/sbin/cardmgr /proc/devices
-
-/sbin/fdisk /proc/ide/%s/media
-/sbin/fdisk /proc/scsi/scsi
-
-/sbin/getty /proc/version
-
-/sbin/ifconfig /proc/net
-/sbin/ifconfig /proc/net/appletalk
-/sbin/ifconfig /proc/net/ax25
-/sbin/ifconfig /proc/net/dev
-/sbin/ifconfig /proc/net/ipx
-/sbin/ifconfig /proc/net/nr
-/sbin/ifconfig /proc/net/unix
-
-/sbin/ifup /proc/sys/kernel/modprobe
-
-/sbin/ipchains /proc/net/ip_fwchains
-/sbin/ipchains /proc/net/ip_fwnames
-/sbin/ipchains /proc/net/ip_masquerade
-/sbin/ipchains /proc/sys/net/ipv4/ip_forward
-
-/sbin/ipmaddr /proc/net/dev_mcast
-/sbin/ipmaddr /proc/net/igmp
-/sbin/ipmaddr /proc/net/igmp6
-
-/sbin/iptunnel /proc/net/dev
-
-/sbin/killall5 /proc/%s/cmdline
-/sbin/killall5 /proc/%s/exe
-/sbin/killall5 /proc/%s/stat
-/sbin/killall5 /proc/version
-
-/sbin/klogd /proc/kmsg
-
-/sbin/lsmod /proc/modules
-
-/sbin/modprobe /proc/modules
-
-/sbin/pidof /proc/%s/cmdline
-/sbin/pidof /proc/%s/exe
-/sbin/pidof /proc/%s/stat
-/sbin/pidof /proc/version
-
-/sbin/probe /proc/pci
-
-/sbin/rarp /proc/net/ax25
-/sbin/rarp /proc/net/nr
-/sbin/rarp /proc/net/rarp
-
-/sbin/rmmod /proc/modules
-
-/sbin/rmmod.static /proc/modules
-
-/sbin/route /proc/net/appletalk
-/sbin/route /proc/net/ax25
-/sbin/route /proc/net/ax25_route
-/sbin/route /proc/net/ipx
-/sbin/route /proc/net/ipx_route
-/sbin/route /proc/net/nr
-/sbin/route /proc/net/nr_neigh
-/sbin/route /proc/net/nr_nodes
-/sbin/route /proc/net/route
-/sbin/route /proc/net/rt_cache
-/sbin/route /proc/net/unix
-
-/sbin/scsi_info /proc/scsi
-/sbin/scsi_info /proc/scsi/%s
-/sbin/scsi_info /proc/scsi/scsi
-
-/sbin/slattach /proc/net/ax25
-/sbin/slattach /proc/net/nr
-
-/sbin/swapoff /proc/swaps
-
-/sbin/swapon /proc/swaps
-
-/sbin/uugetty /proc/version
-
-/usr/bin/dig /proc/
-/usr/bin/dig /proc/interrupts
-/usr/bin/dig /proc/meminfo
-/usr/bin/dig /proc/rtc
-/usr/bin/dig /proc/self/status
-/usr/bin/dig /proc/stat
-
-/usr/bin/dnsquery /proc/
-/usr/bin/dnsquery /proc/interrupts
-/usr/bin/dnsquery /proc/meminfo
-/usr/bin/dnsquery /proc/rtc
-/usr/bin/dnsquery /proc/self/status
-/usr/bin/dnsquery /proc/stat
-
-/usr/bin/eject /proc/mounts
-
-/usr/bin/emacs /proc/loadavg
-
-/usr/bin/fetchmail /proc/net/dev
-
-/usr/bin/free /proc/meminfo
-
-/usr/bin/gmake /proc/loadavg
-
-/usr/bin/gpm-root /proc/loadavg
-/usr/bin/gpm-root /proc/meminfo
-
-/usr/bin/host /proc/
-/usr/bin/host /proc/interrupts
-/usr/bin/host /proc/meminfo
-/usr/bin/host /proc/rtc
-/usr/bin/host /proc/self/status
-/usr/bin/host /proc/stat
-
-/usr/bin/hoststat /proc/loadavg
-
-/usr/bin/hwdiag /proc/cpuinfo
-/usr/bin/hwdiag /proc/pci
-/usr/bin/hwdiag /proc/scsi/scsi
-/usr/bin/hwdiag /proc/version
-
-/usr/bin/lsdev /proc/dma
-/usr/bin/lsdev /proc/interrupts
-/usr/bin/lsdev /proc/ioports
-
-/usr/bin/mailq /proc/loadavg
-
-/usr/bin/make /proc/loadavg
-
-/usr/bin/mcookie /proc/loadavg
-/usr/bin/mcookie /proc/stat
-
-/usr/bin/newaliases /proc/loadavg
-
-/usr/bin/nslookup /proc/
-/usr/bin/nslookup /proc/interrupts
-/usr/bin/nslookup /proc/meminfo
-/usr/bin/nslookup /proc/rtc
-/usr/bin/nslookup /proc/self/status
-/usr/bin/nslookup /proc/stat
-
-/usr/bin/nsupdate /proc/
-/usr/bin/nsupdate /proc/interrupts
-/usr/bin/nsupdate /proc/meminfo
-/usr/bin/nsupdate /proc/rtc
-/usr/bin/nsupdate /proc/self/status
-/usr/bin/nsupdate /proc/stat
-
-/usr/bin/pgp /proc/version
-/usr/bin/pgpe /proc/version
-/usr/bin/pgpk /proc/version
-/usr/bin/pgps /proc/version
-/usr/bin/pgpv /proc/version
-
-/usr/bin/procinfo /proc/cmdline
-/usr/bin/procinfo /proc/devices
-/usr/bin/procinfo /proc/dma
-/usr/bin/procinfo /proc/filesystems
-/usr/bin/procinfo /proc/interrupts
-/usr/bin/procinfo /proc/loadavg
-/usr/bin/procinfo /proc/meminfo
-/usr/bin/procinfo /proc/modules
-/usr/bin/procinfo /proc/stat
-/usr/bin/procinfo /proc/uptime
-/usr/bin/procinfo /proc/version
-
-/usr/bin/purgestat /proc/loadavg
-
-/usr/bin/screen /proc/loadavg
-
-/usr/bin/strace /proc/%d/stat
-
-/usr/bin/top /proc/cpuinfo
-/usr/bin/top /proc/meminfo
-/usr/bin/top /proc/stat
-
-/usr/bin/vmstat /proc/%s/stat
-/usr/bin/vmstat /proc/meminfo
-/usr/bin/vmstat /proc/stat
-
-/usr/sbin/atd /proc/loadavg
-
-/usr/sbin/dnskeygen /proc/
-/usr/sbin/dnskeygen /proc/interrupts
-/usr/sbin/dnskeygen /proc/meminfo
-/usr/sbin/dnskeygen /proc/rtc
-/usr/sbin/dnskeygen /proc/self/status
-/usr/sbin/dnskeygen /proc/stat
-
-/usr/sbin/fuser /proc/%d/stat
-/usr/sbin/fuser /proc/net/%s
-/usr/sbin/fuser /proc/net/unix
-
-/usr/sbin/in.identd /proc/net/tcp
-
-/usr/sbin/irpd /proc/
-/usr/sbin/irpd /proc/interrupts
-/usr/sbin/irpd /proc/meminfo
-/usr/sbin/irpd /proc/rtc
-/usr/sbin/irpd /proc/self/status
-/usr/sbin/irpd /proc/stat
-
-/usr/sbin/named /proc/
-/usr/sbin/named /proc/interrupts
-/usr/sbin/named /proc/meminfo
-/usr/sbin/named /proc/rtc
-/usr/sbin/named /proc/self/status
-/usr/sbin/named /proc/stat
-
-/usr/sbin/named-xfer /proc/
-/usr/sbin/named-xfer /proc/interrupts
-/usr/sbin/named-xfer /proc/meminfo
-/usr/sbin/named-xfer /proc/rtc
-/usr/sbin/named-xfer /proc/self/status
-/usr/sbin/named-xfer /proc/stat
-
-/usr/sbin/readprofile /proc/profile
-
-/usr/sbin/rwhod /proc/loadavg
-/usr/sbin/rwhod /proc/uptime
-
-/usr/sbin/sendmail /proc/loadavg
-
-/usr/sbin/setconsole /proc/openprom/options
-/usr/sbin/setconsole /proc/openprom/options/${console}-mode
-/usr/sbin/setconsole /proc/openprom/options/input-device
-/usr/sbin/setconsole /proc/openprom/options/output-device
-
-Best wishes from Riley.
-
- * Copyright (C) 1999, Memory Alpha Systems.
- * All rights and wrongs reserved.
-
-+----------------------------------------------------------------------+
-| There is something frustrating about the quality and speed of Linux  |
-| development, ie., the quality is too high and the speed is too high, |
-| in other words, I can implement this XXXX feature, but I bet someone |
-| else has already done so and is just about to release their patch.   |
-+----------------------------------------------------------------------+
- * http://www.memalpha.cx/Linux/Kernel/
-
-
--
-To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
-the body of a message to majordomo@vger.rutgers.edu
-Please read the FAQ at http://www.tux.org/lkml/
-
diff --git a/applets/busybox.mkll b/applets/busybox.mkll
index c650feb..d8ea7b3 100755
--- a/applets/busybox.mkll
+++ b/applets/busybox.mkll
@@ -1,19 +1,19 @@
 #!/bin/sh
 # Make busybox links list file.
 
-DF="busybox.def.h"
+DF="Config.h"
 MF="busybox.c"
 
 LIST="$(gcc -E -dM $DF | sed -n -e '/^.*BB_FEATURE.*$/d;s/^#define.*\<BB_\(.*\)\>/BB_\1/gp;' | sort)"
 
 for def in ${LIST}; do
 	i=`sed -n '/^#ifdef \<'$def'\>.*/,/^#endif/{ s/.*\"\(.*\)\".*\(_BB_DIR_[A-Z_]*\).*$/\2\/\1/gp; }' $MF`
 	for j in $i; do 
 		if [ -z $j ] ; then 
 			continue;
 		fi;
 		echo $j | sed -e 's/_BB_DIR_ROOT//g;s/_BB_DIR_BIN/\/bin/g;' \
 		    -e 's/_BB_DIR_SBIN/\/sbin/g;s/_BB_DIR_USR_BIN/\/usr\/bin/g;' \
 		    -e 's/_BB_DIR_USR_SBIN/\/usr\/sbin/g;'
 	done;
 done
diff --git a/applets/busybox.sh b/applets/busybox.sh
index 2b45210..e01b881 100755
--- a/applets/busybox.sh
+++ b/applets/busybox.sh
@@ -1,10 +1,10 @@
 #!/bin/sh
 
 # I added in the extra "ls" so only source files that
 # actually exist will show up in the compile list.
 ls -1 ` \
-    gcc -E -dM busybox.def.h | \
+    gcc -E -dM Config.h | \
     sed -n -e '/^.*BB_FEATURE.*$/d;s/^#define.*\<BB_\(.*\)\>/\1.c/gp;' \
     | tr '[:upper:]' '[:lower:]' | sort
 ` 2>/dev/null | sed -e 's/\.c$/\.o/g'
 
diff --git a/busybox.def.h b/busybox.def.h
deleted file mode 100644
index a376dee..0000000
--- a/busybox.def.h
+++ /dev/null
@@ -1,330 +0,0 @@
-/* vi: set sw=4 ts=4: */
-// This file defines the feature set to be compiled into busybox.
-// When you turn things off here, they won't be compiled in at all.
-//
-//// This file is parsed by sed. You MUST use single line comments.
-//   i.e.  //#define BB_BLAH
-//
-//
-// BusyBox Applications
-#define BB_AR
-#define BB_BASENAME
-#define BB_CAT
-#define BB_CHMOD_CHOWN_CHGRP
-#define BB_CHROOT
-#define BB_CHVT
-#define BB_CLEAR
-#define BB_CP_MV
-#define BB_CUT
-#define BB_DATE
-#define BB_DC
-#define BB_DD
-#define BB_DEALLOCVT
-#define BB_DF
-#define BB_DIRNAME
-#define BB_DMESG
-#define BB_DOS2UNIX
-#define BB_DUTMP
-#define BB_DU
-#define BB_DUMPKMAP
-#define BB_ECHO
-#define BB_EXPR
-#define BB_FBSET
-#define BB_FDFLUSH
-#define BB_FIND
-#define BB_FREE
-#define BB_FREERAMDISK
-#define BB_FSCK_MINIX
-#define BB_GETOPT
-#define BB_GREP
-#define BB_GUNZIP
-#define BB_GZIP
-#define BB_HALT
-#define BB_HEAD
-#define BB_HOSTID
-#define BB_HOSTNAME
-#define BB_ID
-#define BB_INIT
-#define BB_INSMOD
-#define BB_KILL
-#define BB_KILLALL
-#define BB_LENGTH
-#define BB_LN
-#define BB_LOADACM
-#define BB_LOADFONT
-#define BB_LOADKMAP
-#define BB_LOGGER
-#define BB_LOGNAME
-#define BB_LS
-#define BB_LSMOD
-#define BB_MAKEDEVS
-#define BB_MD5SUM
-#define BB_MKDIR
-#define BB_MKFIFO
-#define BB_MKFS_MINIX
-#define BB_MKNOD
-#define BB_MKSWAP
-#define BB_MKTEMP
-#define BB_NC
-#define BB_MORE
-#define BB_MOUNT
-#define BB_MT
-#define BB_NSLOOKUP
-#define BB_PING
-#define BB_POWEROFF
-#define BB_PRINTF
-#define BB_PS
-#define BB_PWD
-#define BB_RDATE
-#define BB_REBOOT
-#define BB_RENICE
-#define BB_RESET
-#define BB_RM
-#define BB_RMDIR
-#define BB_RMMOD
-#define BB_SED
-#define BB_SETKEYCODES
-#define BB_SH
-#define BB_SLEEP
-#define BB_SORT
-#define BB_SWAPONOFF
-#define BB_SYNC
-#define BB_SYSLOGD
-#define BB_TAIL
-#define BB_TAR
-#define BB_TEE
-#define BB_TEST
-#define BB_TELNET
-#define BB_TOUCH
-#define BB_TR
-#define BB_TRUE_FALSE
-#define BB_TTY
-#define BB_UNRPM
-#define BB_UPTIME
-#define BB_USLEEP
-#define BB_WC
-#define BB_WGET
-#define BB_WHICH
-#define BB_WHOAMI
-#define BB_UUENCODE
-#define BB_UUDECODE
-#define BB_UMOUNT
-#define BB_UNIQ
-#define BB_UNAME
-#define BB_UNIX2DOS
-#define BB_UPDATE
-#define BB_XARGS
-#define BB_YES
-// End of Applications List
-//
-//
-//
-// ---------------------------------------------------------
-// This is where feature definitions go.  Generally speaking,
-// turning this stuff off makes things a bit smaller (and less 
-// pretty/useful).
-//
-//
-//
-// Turn this on to use Erik's very cool devps, devmtab, etc kernel drivers,
-// thereby eliminating the need for the /proc filesystem and thereby saving
-// lots and lots memory for more important things.  You can not use this and
-// USE_PROCFS at the same time...  NOTE:  If you enable this feature, you
-// _must_ have patched the kernel to include the devps patch that is included
-// in the busybox/kernel-patches directory.  You will also need to create some
-// device special files in /dev on your embedded system:
-//        mknod /dev/modules c 10 23
-//        mknod /dev/mtab c 10 22
-//        mknod /dev/ps c 10 21
-// I emailed Linus and this patch will not be going into the stock kernel.
-//#define BB_FEATURE_USE_DEVPS_PATCH
-//
-// enable features that use the /proc filesystem (apps that 
-// break without this will tell you on compile)...
-// You can't use this and BB_FEATURE_USE_DEVPS_PATCH 
-// at the same time...
-#define BB_FEATURE_USE_PROCFS
-//
-// This compiles out everything but the most 
-// trivial --help usage information (i.e. reduces binary size)
-//#define BB_FEATURE_TRIVIAL_HELP
-//
-// Use termios to manipulate the screen ('more' is prettier with this on)
-#define BB_FEATURE_USE_TERMIOS
-//
-// calculate terminal & column widths (for more and ls)
-#define BB_FEATURE_AUTOWIDTH
-//
-// show username/groupnames (bypasses libc6 NSS) for ls
-#define BB_FEATURE_LS_USERNAME
-//
-// show file timestamps in ls
-#define BB_FEATURE_LS_TIMESTAMPS
-//
-// enable ls -p and -F
-#define BB_FEATURE_LS_FILETYPES
-//
-// sort the file names (still a bit buggy)
-#define BB_FEATURE_LS_SORTFILES
-//
-// enable ls -R
-#define BB_FEATURE_LS_RECURSIVE
-//
-// enable ls -L
-#define BB_FEATURE_LS_FOLLOWLINKS
-//
-// Change ping implementation -- simplified, featureless, but really small.
-//#define BB_FEATURE_SIMPLE_PING
-//
-// Make init use a simplified /etc/inittab file (recommended).
-#define BB_FEATURE_USE_INITTAB
-//
-//Enable init being called as /linuxrc
-#define BB_FEATURE_LINUXRC
-//
-//Have init enable core dumping for child processes (for debugging only) 
-//#define BB_FEATURE_INIT_COREDUMPS
-//
-// Allow init to permenently chroot, and umount the old root fs
-// just like an initrd does.  Requires a kernel patch by Werner Almesberger. 
-// ftp://icaftp.epfl.ch/pub/people/almesber/misc/umount-root-*.tar.gz
-//#define BB_FEATURE_INIT_CHROOT
-//
-//Make sure nothing is printed to the console on boot
-#define BB_FEATURE_EXTRA_QUIET
-//
-//Should syslogd also provide klogd support?
-#define BB_FEATURE_KLOGD
-//
-// enable syslogd -R remotehost
-#define BB_FEATURE_REMOTE_LOG
-//
-//Simple tail implementation (2.34k vs 3k for the full one).
-//Both provide 'tail -f' support (only one file at a time.)
-#define BB_FEATURE_SIMPLE_TAIL
-//
-// Enable support for loop devices in mount
-#define BB_FEATURE_MOUNT_LOOP
-//
-// Enable support for a real /etc/mtab file instead of /proc/mounts
-//#define BB_FEATURE_MOUNT_MTAB_SUPPORT
-//
-// Enable support for mounting remote NFS volumes
-#define BB_FEATURE_NFSMOUNT
-//
-// Enable support forced filesystem unmounting 
-// (i.e. in case of an unreachable NFS system).
-#define BB_FEATURE_MOUNT_FORCE
-//
-// Enable support for creation of tar files.
-#define BB_FEATURE_TAR_CREATE
-//
-// Enable support for "--exclude" for excluding files
-#define BB_FEATURE_TAR_EXCLUDE
-//
-// Enable support for s///p pattern matching
-#define BB_FEATURE_SED_PATTERN_SPACE
-//
-//// Enable reverse sort
-#define BB_FEATURE_SORT_REVERSE
-//
-// Enable command line editing in the shell
-#define BB_FEATURE_SH_COMMAND_EDITING
-//
-//Allow the shell to invoke all the compiled in BusyBox commands as if they
-//were shell builtins.  Nice for staticly linking an emergency rescue shell
-//among other thing.
-#define BB_FEATURE_SH_STANDALONE_SHELL
-//
-// Enable tab completion in the shell (not yet 
-// working very well -- so don't turn this on)
-//#define BB_FEATURE_SH_TAB_COMPLETION
-//
-//Turn on extra fbset options
-//#define BB_FEATURE_FBSET_FANCY
-//
-//Turn on fbset readmode support
-//#define BB_FEATURE_FBSET_READMODE
-//
-// You must enable one or both of these features
-// Support installing modules from pre 2.1 kernels
-//#define BB_FEATURE_INSMOD_OLD_KERNEL
-// Support installing modules from kernel versions after 2.1.18
-#define BB_FEATURE_INSMOD_NEW_KERNEL
-//
-// Support module version checking
-//#define BB_FEATURE_INSMOD_VERSION_CHECKING
-//
-// Support for Minix filesystem, version 2
-//#define BB_FEATURE_MINIX2
-//
-//
-// Enable busybox --install [-s]
-// to create links (or symlinks) for all the commands that are 
-// compiled into the binary.  (needs /proc filesystem)
-// #define BB_FEATURE_INSTALLER
-//
-// Clean up all memory before exiting -- usually not needed
-// as the OS can clean up...  Don't enable this unless you
-// have a really good reason for cleaning things up manually.
-//#define BB_FEATURE_CLEAN_UP
-//
-// End of Features List
-//
-//
-//
-//
-//
-//
-//---------------------------------------------------
-// Nothing beyond this point should ever be touched by 
-// mere mortals so leave this stuff alone.
-//
-#ifdef BB_FEATURE_MOUNT_MTAB_SUPPORT
-#define BB_MTAB
-#endif
-//
-#if defined BB_FEATURE_SH_COMMAND_EDITING && defined BB_SH
-#define BB_CMDEDIT
-#endif
-//
-#ifdef BB_KILLALL
-#ifndef BB_KILL
-#define BB_KILL
-#endif
-#endif
-//
-#ifdef BB_FEATURE_LINUXRC
-#ifndef BB_INIT
-#define BB_INIT
-#endif
-#define BB_LINUXRC
-#endif
-//
-#ifdef BB_GZIP
-#ifndef BB_GUNZIP
-#define BB_GUNZIP
-#endif
-#endif
-//
-#if defined BB_MOUNT && defined BB_FEATURE_NFSMOUNT
-#define BB_NFSMOUNT
-#endif
-//
-#if defined BB_FEATURE_SH_COMMAND_EDITING
-#ifndef BB_FEATURE_USE_TERMIOS
-#define BB_FEATURE_USE_TERMIOS
-#endif
-#endif
-//
-#if defined BB_FEATURE_AUTOWIDTH
-#ifndef BB_FEATURE_USE_TERMIOS
-#define BB_FEATURE_USE_TERMIOS
-#endif
-#endif
-//
-#if defined BB_INSMOD
-#ifndef BB_FEATURE_INSMOD_OLD_KERNEL
-#define BB_FEATURE_INSMOD_NEW_KERNEL
-#endif
-#endif
diff --git a/busybox.def.h.Hurd b/busybox.def.h.Hurd
deleted file mode 100644
index cfd6873..0000000
--- a/busybox.def.h.Hurd
+++ /dev/null
@@ -1,327 +0,0 @@
-/* vi: set sw=4 ts=4: */
-
-// NOTE: This file only defines features usefull under the Hurd,
-// To compile for the Hurd raname this to busybox.def.h prior to make
-
-// This file defines the feature set to be compiled into busybox.
-// When you turn things off here, they won't be compiled in at all.
-//
-//// This file is parsed by sed. You MUST use single line comments.
-//   i.e.  //#define BB_BLAH
-//
-//
-// BusyBox Applications
-#define BB_AR
-#define BB_BASENAME
-#define BB_CAT
-#define BB_CHMOD_CHOWN_CHGRP
-#define BB_CHROOT
-//#define BB_CHVT	/* not needed */
-#define BB_CLEAR
-#define BB_CP_MV
-#define BB_CUT
-#define BB_DATE
-#define BB_DC
-#define BB_DD
-//#define BB_DEALLOCVT	/* inot needed */
-//#define BB_DF		/* different implementation */
-#define BB_DIRNAME
-//#define BB_DMESG	/* doesnt compile, different implementation  */
-#define BB_DUTMP
-#define BB_DU
-//#define BB_DUMPKMAP	/* not needed */
-#define BB_ECHO
-#define BB_EXPR
-//#define BB_FBSET	/* not needed, doesnt compile */
-//#define BB_FDFLUSH 	/* is this needed? */
-#define BB_FIND
-//#define BB_FREE	/* doesnt compile */
-#define BB_FREERAMDISK  /* does hurd support ramdisks ? */
-#define BB_FSCK_MINIX
-#define BB_GETOPT
-#define BB_GREP
-#define BB_GUNZIP
-#define BB_GZIP
-#define BB_HALT
-#define BB_HEAD
-#define BB_HOSTID
-#define BB_HOSTNAME
-#define BB_ID
-//#define BB_INIT	/* not needed?, doesnt compile */
-//#define BB_INSMOD	/* not needed, doesnt compile */
-#define BB_KILL
-#define BB_KILLALL
-#define BB_LENGTH
-#define BB_LN
-//#define BB_LOADACM	/* not needed, doesnt compile */
-//#define BB_LOADFONT	/* not needed, doesnt compile */
-//#define BB_LOADKMAP	/* not needed */
-#define BB_LOGGER
-#define BB_LOGNAME
-#define BB_LS
-//#define BB_LSMOD	/* not needed, doesnt compile */
-//#define BB_MAKEDEVS	/* different implementation */
-#define BB_MD5SUM
-#define BB_MKDIR
-#define BB_MKFIFO
-#define BB_MKFS_MINIX
-#define BB_MKNOD
-//#define BB_MKSWAP 	/* different impelementation (i think) */
-#define BB_MKTEMP
-#define BB_NC
-#define BB_MORE
-//#define BB_MOUNT	/* different implementation */
-#define BB_MT
-#define BB_NSLOOKUP
-//#define BB_PING	/* doesnt compile, Hurd uses BSD style ip.h */
-//#define BB_POWEROFF	/* different implementation i assume */
-#define BB_PRINTF
-//#define BB_PS		/* needs /proc */
-#define BB_PWD
-#define BB_RDATE
-//#define BB_REBOOT	/* different implementation */
-#define BB_RENICE
-#define BB_RESET
-#define BB_RM
-#define BB_RMDIR
-//#define BB_RMMOD	/* not needed, doesnt compile */
-#define BB_SED
-//#define BB_SETKEYCODES /* is this needed ? */
-#define BB_SH
-#define BB_SLEEP
-#define BB_SORT
-//#define BB_SWAPONOFF	/* different implementation, doesnt compile */
-#define BB_SYNC
-//#define BB_SYSLOGD 	/* doesnt compile */
-#define BB_TAIL
-#define BB_TAR
-#define BB_TEE
-#define BB_TEST
-#define BB_TELNET
-#define BB_TOUCH
-#define BB_TR
-#define BB_TRUE_FALSE
-#define BB_TTY
-//#define BB_UPTIME 	/* doesnt compile */
-#define BB_USLEEP
-#define BB_WC
-#define BB_WGET
-#define BB_WHICH
-#define BB_WHOAMI
-#define BB_UUENCODE
-#define BB_UUDECODE
-//#define BB_UMOUNT	/* different implementation */
-#define BB_UNIQ
-//#define BB_UNAME	/* doesnt compile */
-//#define BB_UPDATE	/* doesnt compile */
-#define BB_YES
-// End of Applications List
-//
-//
-//
-// ---------------------------------------------------------
-// This is where feature definitions go.  Generally speaking,
-// turning this stuff off makes things a bit smaller (and less 
-// pretty/useful).
-//
-//
-//
-// Turn this on to use Erik's very cool devps, devmtab, etc kernel drivers,
-// thereby eliminating the need for the /proc filesystem and thereby saving
-// lots and lots memory for more important things.  You can not use this and
-// USE_PROCFS at the same time...  NOTE:  If you enable this feature, you
-// _must_ have patched the kernel to include the devps patch that is included
-// in the busybox/kernel-patches directory.  You will also need to create some
-// device special files in /dev on your embedded system:
-//        mknod /dev/modules c 10 23
-//        mknod /dev/mtab c 10 22
-//        mknod /dev/ps c 10 21
-// I emailed Linus and this patch will not be going into the stock kernel.
-//#define BB_FEATURE_USE_DEVPS_PATCH
-//
-// enable features that use the /proc filesystem (apps that 
-// break without this will tell you on compile)...
-// You can't use this and BB_FEATURE_USE_DEVPS_PATCH 
-// at the same time...
-#define BB_FEATURE_USE_PROCFS
-//
-// This compiles out everything but the most 
-// trivial --help usage information (i.e. reduces binary size)
-//#define BB_FEATURE_TRIVIAL_HELP
-//
-// Use termios to manipulate the screen ('more' is prettier with this on)
-#define BB_FEATURE_USE_TERMIOS
-//
-// calculate terminal & column widths (for more and ls)
-#define BB_FEATURE_AUTOWIDTH
-//
-// show username/groupnames (bypasses libc6 NSS) for ls
-#define BB_FEATURE_LS_USERNAME
-//
-// show file timestamps in ls
-#define BB_FEATURE_LS_TIMESTAMPS
-//
-// enable ls -p and -F
-#define BB_FEATURE_LS_FILETYPES
-//
-// sort the file names (still a bit buggy)
-#define BB_FEATURE_LS_SORTFILES
-//
-// enable ls -R
-#define BB_FEATURE_LS_RECURSIVE
-//
-// Change ping implementation -- simplified, featureless, but really small.
-#define BB_FEATURE_SIMPLE_PING
-//
-// Make init use a simplified /etc/inittab file (recommended).
-#define BB_FEATURE_USE_INITTAB
-//
-//Enable init being called as /linuxrc
-//#define BB_FEATURE_LINUXRC
-//
-//Have init enable core dumping for child processes (for debugging only) 
-//#define BB_FEATURE_INIT_COREDUMPS
-//
-// Allow init to permenently chroot, and umount the old root fs
-// just like an initrd does.  Requires a kernel patch by Werner Almesberger. 
-// ftp://icaftp.epfl.ch/pub/people/almesber/misc/umount-root-*.tar.gz
-//#define BB_FEATURE_INIT_CHROOT
-//
-//Make sure nothing is printed to the console on boot
-#define BB_FEATURE_EXTRA_QUIET
-//
-//Should syslogd also provide klogd support?
-#define BB_FEATURE_KLOGD
-//
-// enable syslogd -R remotehost
-#define BB_FEATURE_REMOTE_LOG
-//
-//Simple tail implementation (2.34k vs 3k for the full one).
-//Both provide 'tail -f' support (only one file at a time.)
-#define BB_FEATURE_SIMPLE_TAIL
-//
-// Enable support for loop devices in mount
-//#define BB_FEATURE_MOUNT_LOOP
-//
-// Enable support for a real /etc/mtab file instead of /proc/mounts
-//#define BB_FEATURE_MOUNT_MTAB_SUPPORT
-//
-// Enable support for mounting remote NFS volumes
-//#define BB_FEATURE_NFSMOUNT
-//
-// Enable support forced filesystem unmounting 
-// (i.e. in case of an unreachable NFS system).
-#define BB_FEATURE_MOUNT_FORCE
-//
-// Enable support for creation of tar files.
-#define BB_FEATURE_TAR_CREATE
-//
-// Enable support for "--exclude" for excluding files
-#define BB_FEATURE_TAR_EXCLUDE
-//
-// Enable support for s///p pattern matching
-#define BB_FEATURE_SED_PATTERN_SPACE
-//
-//// Enable reverse sort
-#define BB_FEATURE_SORT_REVERSE
-//
-// Enable command line editing in the shell
-#define BB_FEATURE_SH_COMMAND_EDITING
-//
-//Allow the shell to invoke all the compiled in BusyBox commands as if they
-//were shell builtins.  Nice for staticly linking an emergency rescue shell
-//among other thing.
-#define BB_FEATURE_SH_STANDALONE_SHELL
-//
-// Enable tab completion in the shell (not yet 
-// working very well -- so don't turn this on)
-//#define BB_FEATURE_SH_TAB_COMPLETION
-//
-//Turn on extra fbset options
-//#define BB_FEATURE_FBSET_FANCY
-//
-//Turn on fbset readmode support
-//#define BB_FEATURE_FBSET_READMODE
-//
-// You must enable one or both of these features
-// Support installing modules from pre 2.1 kernels
-//#define BB_FEATURE_INSMOD_OLD_KERNEL
-// Support installing modules from kernel versions after 2.1.18
-#define BB_FEATURE_INSMOD_NEW_KERNEL
-//
-// Support module version checking
-//#define BB_FEATURE_INSMOD_VERSION_CHECKING
-//
-// Support for Minix filesystem, version 2
-//#define BB_FEATURE_MINIX2
-//
-//
-// Enable busybox --install [-s]
-// to create links (or symlinks) for all the commands that are 
-// compiled into the binary.  (needs /proc filesystem)
-// #define BB_FEATURE_INSTALLER
-//
-// Clean up all memory before exiting -- usually not needed
-// as the OS can clean up...  Don't enable this unless you
-// have a really good reason for cleaning things up manually.
-//#define BB_FEATURE_CLEAN_UP
-//
-// End of Features List
-//
-//
-//
-//
-//
-//
-//---------------------------------------------------
-// Nothing beyond this point should ever be touched by 
-// mere mortals so leave this stuff alone.
-//
-#ifdef BB_FEATURE_MOUNT_MTAB_SUPPORT
-#define BB_MTAB
-#endif
-//
-#if defined BB_FEATURE_SH_COMMAND_EDITING && defined BB_SH
-#define BB_CMDEDIT
-#endif
-//
-#ifdef BB_KILLALL
-#ifndef BB_KILL
-#define BB_KILL
-#endif
-#endif
-//
-#ifdef BB_FEATURE_LINUXRC
-#ifndef BB_INIT
-#define BB_INIT
-#endif
-#define BB_LINUXRC
-#endif
-//
-#ifdef BB_GZIP
-#ifndef BB_GUNZIP
-#define BB_GUNZIP
-#endif
-#endif
-//
-#if defined BB_MOUNT && defined BB_FEATURE_NFSMOUNT
-#define BB_NFSMOUNT
-#endif
-//
-#if defined BB_FEATURE_SH_COMMAND_EDITING
-#ifndef BB_FEATURE_USE_TERMIOS
-#define BB_FEATURE_USE_TERMIOS
-#endif
-#endif
-//
-#if defined BB_FEATURE_AUTOWIDTH
-#ifndef BB_FEATURE_USE_TERMIOS
-#define BB_FEATURE_USE_TERMIOS
-#endif
-#endif
-//
-#if defined BB_INSMOD
-#ifndef BB_FEATURE_INSMOD_OLD_KERNEL
-#define BB_FEATURE_INSMOD_NEW_KERNEL
-#endif
-#endif
diff --git a/busybox.mkll b/busybox.mkll
index c650feb..d8ea7b3 100755
--- a/busybox.mkll
+++ b/busybox.mkll
@@ -1,19 +1,19 @@
 #!/bin/sh
 # Make busybox links list file.
 
-DF="busybox.def.h"
+DF="Config.h"
 MF="busybox.c"
 
 LIST="$(gcc -E -dM $DF | sed -n -e '/^.*BB_FEATURE.*$/d;s/^#define.*\<BB_\(.*\)\>/BB_\1/gp;' | sort)"
 
 for def in ${LIST}; do
 	i=`sed -n '/^#ifdef \<'$def'\>.*/,/^#endif/{ s/.*\"\(.*\)\".*\(_BB_DIR_[A-Z_]*\).*$/\2\/\1/gp; }' $MF`
 	for j in $i; do 
 		if [ -z $j ] ; then 
 			continue;
 		fi;
 		echo $j | sed -e 's/_BB_DIR_ROOT//g;s/_BB_DIR_BIN/\/bin/g;' \
 		    -e 's/_BB_DIR_SBIN/\/sbin/g;s/_BB_DIR_USR_BIN/\/usr\/bin/g;' \
 		    -e 's/_BB_DIR_USR_SBIN/\/usr\/sbin/g;'
 	done;
 done
diff --git a/busybox.sh b/busybox.sh
index 2b45210..e01b881 100755
--- a/busybox.sh
+++ b/busybox.sh
@@ -1,10 +1,10 @@
 #!/bin/sh
 
 # I added in the extra "ls" so only source files that
 # actually exist will show up in the compile list.
 ls -1 ` \
-    gcc -E -dM busybox.def.h | \
+    gcc -E -dM Config.h | \
     sed -n -e '/^.*BB_FEATURE.*$/d;s/^#define.*\<BB_\(.*\)\>/\1.c/gp;' \
     | tr '[:upper:]' '[:lower:]' | sort
 ` 2>/dev/null | sed -e 's/\.c$/\.o/g'
 
diff --git a/busybox.spec b/busybox.spec
index cb185a7..c11756b 100644
--- a/busybox.spec
+++ b/busybox.spec
@@ -1,36 +1,36 @@
 Name: busybox
-Version: 0.47pre
+Version: 0.47
 Release: 1
 Group: System/Utilities
 Summary: BusyBox is a tiny suite of Unix utilities in a multi-call binary.
 Copyright: GPL
 Packager : Erik Andersen <andersen@lineo.com>
 Conflicts: fileutils grep shellutils
 Buildroot: /tmp/%{Name}-%{Version}
 Source: %{Name}-%{Version}.tar.gz
 
 %Description
 BusyBox combines tiny versions of many common UNIX utilities into a single
 small executable. It provides minimalist replacements for most of the utilities
 you usually find in fileutils, shellutils, findutils, textutils, grep, gzip,
 tar, etc.  BusyBox provides a fairly complete POSIX environment for any small
 or emdedded system.  The utilities in BusyBox generally have fewer options then
 their full featured GNU cousins; however, the options that are provided behave
 very much like their GNU counterparts.
 
 %Prep
 %setup -q -n %{Name}-%{Version}
 
 %Build
 make
 
 %Install
 rm -rf $RPM_BUILD_ROOT
 make PREFIX=$RPM_BUILD_ROOT install
 
 %Clean
 rm -rf $RPM_BUILD_ROOT
 
 %Files 
 %defattr(-,root,root)
 /
diff --git a/examples/busybox.spec b/examples/busybox.spec
index cb185a7..c11756b 100644
--- a/examples/busybox.spec
+++ b/examples/busybox.spec
@@ -1,36 +1,36 @@
 Name: busybox
-Version: 0.47pre
+Version: 0.47
 Release: 1
 Group: System/Utilities
 Summary: BusyBox is a tiny suite of Unix utilities in a multi-call binary.
 Copyright: GPL
 Packager : Erik Andersen <andersen@lineo.com>
 Conflicts: fileutils grep shellutils
 Buildroot: /tmp/%{Name}-%{Version}
 Source: %{Name}-%{Version}.tar.gz
 
 %Description
 BusyBox combines tiny versions of many common UNIX utilities into a single
 small executable. It provides minimalist replacements for most of the utilities
 you usually find in fileutils, shellutils, findutils, textutils, grep, gzip,
 tar, etc.  BusyBox provides a fairly complete POSIX environment for any small
 or emdedded system.  The utilities in BusyBox generally have fewer options then
 their full featured GNU cousins; however, the options that are provided behave
 very much like their GNU counterparts.
 
 %Prep
 %setup -q -n %{Name}-%{Version}
 
 %Build
 make
 
 %Install
 rm -rf $RPM_BUILD_ROOT
 make PREFIX=$RPM_BUILD_ROOT install
 
 %Clean
 rm -rf $RPM_BUILD_ROOT
 
 %Files 
 %defattr(-,root,root)
 /
diff --git a/internal.h b/internal.h
index f8dd128..69f4554 100644
--- a/internal.h
+++ b/internal.h
@@ -1,468 +1,468 @@
 /* vi: set sw=4 ts=4: */
 /*
  * Busybox main internal header file
  *
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation; either version 2 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  * General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
  *
  * Based in part on code from sash, Copyright (c) 1999 by David I. Bell 
  * Permission has been granted to redistribute this code under the GPL.
  *
  */
 #ifndef	_BB_INTERNAL_H_
 #define	_BB_INTERNAL_H_    1
 
-#include "busybox.def.h"
+#include "Config.h"
 
 #ifdef DMALLOC
 #include "dmalloc.h"
 #endif
 
 #include <stdlib.h>
 #include <stdarg.h>
 #include <string.h>
 #include <unistd.h>
 #include <errno.h>
 #include <sys/stat.h>
 #include <sys/param.h>
 #include <mntent.h>
 #include <regex.h>
 /* for the _syscall() macros */
 #include <sys/syscall.h>
 #include <linux/unistd.h>
 
 
 /* Some useful definitions */
 #define FALSE   ((int) 1)
 #define TRUE    ((int) 0)
 
 /* for mtab.c */
 #define MTAB_GETMOUNTPT '1'
 #define MTAB_GETDEVICE  '2'
 
 #define BUF_SIZE        8192
 #define EXPAND_ALLOC    1024
 
 
 #define isBlank(ch)     (((ch) == ' ') || ((ch) == '\t'))
 #define isDecimal(ch)   (((ch) >= '0') && ((ch) <= '9'))
 #define isOctal(ch)     (((ch) >= '0') && ((ch) <= '7'))
 #define isWildCard(ch)  (((ch) == '*') || ((ch) == '?') || ((ch) == '['))
 
 /* Macros for min/max.  */
 #ifndef MIN
 #define	MIN(a,b) (((a)<(b))?(a):(b))
 #endif
 
 #ifndef MAX
 #define	MAX(a,b) (((a)>(b))?(a):(b))
 #endif
 
 
 /* I don't like nested includes, but the string and io functions are used
  * too often
  */
 #include <stdio.h>
 #if !defined(NO_STRING_H) || defined(STDC_HEADERS)
 #  include <string.h>
 #  if !defined(STDC_HEADERS) && !defined(NO_MEMORY_H) && !defined(__GNUC__)
 #    include <memory.h>
 #  endif
 #  define memzero(s, n)     memset ((void *)(s), 0, (n))
 #else
 #  include <strings.h>
 #  define strchr            index
 #  define strrchr           rindex
 #  define memcpy(d, s, n)   bcopy((s), (d), (n))
 #  define memcmp(s1, s2, n) bcmp((s1), (s2), (n))
 #  define memzero(s, n)     bzero((s), (n))
 #endif
 
 
 enum Location {
 	_BB_DIR_ROOT = 0,
 	_BB_DIR_BIN,
 	_BB_DIR_SBIN,
 	_BB_DIR_USR_BIN,
 	_BB_DIR_USR_SBIN
 };
 
 struct BB_applet {
 	const	char*	name;
 	int	(*main)(int argc, char** argv);
 	enum	Location	location;
 	const	char*	usage;
 };
 /* From busybox.c */
 extern const struct BB_applet applets[];
 
 extern int ar_main(int argc, char **argv);
 extern int basename_main(int argc, char **argv);
 extern int bogomips_main(int argc, char **argv);
 extern int busybox_main(int argc, char** argv);
 extern int cat_main(int argc, char** argv);
 extern int chmod_chown_chgrp_main(int argc, char** argv);
 extern int chroot_main(int argc, char** argv);
 extern int chvt_main(int argc, char** argv);
 extern int clear_main(int argc, char** argv);
 extern int cp_mv_main(int argc, char** argv);
 extern int cut_main(int argc, char** argv);
 extern int date_main(int argc, char** argv);
 extern int dc_main(int argc, char** argv);
 extern int dd_main(int argc, char** argv);
 extern int dirname_main(int argc, char** argv);
 extern int deallocvt_main(int argc, char** argv);
 extern int df_main(int argc, char** argv);
 extern int dmesg_main(int argc, char** argv);
 extern int dos2unix_main(int argc, char** argv);
 extern int du_main(int argc, char** argv);
 extern int dumpkmap_main(int argc, char** argv);
 extern int dutmp_main(int argc, char** argv);
 extern int echo_main(int argc, char** argv);
 extern int expr_main(int argc, char** argv);
 extern int false_main(int argc, char** argv);
 extern int fbset_main(int argc, char** argv);
 extern int fdisk_main(int argc, char** argv);
 extern int fdflush_main(int argc, char **argv);
 extern int fsck_minix_main(int argc, char **argv);
 extern int find_main(int argc, char** argv);
 extern int free_main(int argc, char** argv);
 extern int freeramdisk_main(int argc, char** argv);
 extern int getopt_main(int argc, char** argv);
 extern int grep_main(int argc, char** argv);
 extern int gunzip_main (int argc, char** argv);
 extern int gzip_main(int argc, char** argv);
 extern int halt_main(int argc, char** argv);
 extern int head_main(int argc, char** argv);
 extern int hostid_main(int argc, char** argv);
 extern int hostname_main(int argc, char** argv);
 extern int id_main(int argc, char** argv);
 extern int init_main(int argc, char** argv);
 extern int insmod_main(int argc, char** argv);
 extern int kill_main(int argc, char** argv);
 extern int length_main(int argc, char** argv);
 extern int ln_main(int argc, char** argv);
 extern int loadacm_main(int argc, char** argv);
 extern int loadfont_main(int argc, char** argv);
 extern int loadkmap_main(int argc, char** argv);
 extern int losetup_main(int argc, char** argv);
 extern int logger_main(int argc, char **argv);
 extern int logname_main(int argc, char **argv);
 extern int ls_main(int argc, char** argv);
 extern int lsmod_main(int argc, char** argv);
 extern int makedevs_main(int argc, char** argv);
 extern int md5sum_main(int argc, char** argv);
 extern int mkdir_main(int argc, char** argv);
 extern int mkfifo_main(int argc, char **argv);
 extern int mkfs_minix_main(int argc, char **argv);
 extern int mknod_main(int argc, char** argv);
 extern int mkswap_main(int argc, char** argv);
 extern int mktemp_main(int argc, char **argv);
 extern int nc_main(int argc, char** argv);
 extern int more_main(int argc, char** argv);
 extern int mount_main(int argc, char** argv);
 extern int mt_main(int argc, char** argv);
 extern int nslookup_main(int argc, char **argv);
 extern int ping_main(int argc, char **argv);
 extern int poweroff_main(int argc, char **argv);
 extern int printf_main(int argc, char** argv);
 extern int ps_main(int argc, char** argv);
 extern int pwd_main(int argc, char** argv);
 extern int rdate_main(int argc, char** argv);
 extern int reboot_main(int argc, char** argv);
 extern int renice_main(int argc, char** argv);
 extern int reset_main(int argc, char** argv);
 extern int rm_main(int argc, char** argv);
 extern int rmdir_main(int argc, char **argv);
 extern int rmmod_main(int argc, char** argv);
 extern int sed_main(int argc, char** argv);
 extern int sfdisk_main(int argc, char** argv);
 extern int setkeycodes_main(int argc, char** argv);
 extern int shell_main(int argc, char** argv);
 extern int sleep_main(int argc, char** argv);
 extern int sort_main(int argc, char** argv);
 extern int swap_on_off_main(int argc, char** argv);
 extern int sync_main(int argc, char** argv);
 extern int syslogd_main(int argc, char **argv);
 extern int tail_main(int argc, char** argv);
 extern int tar_main(int argc, char** argv);
 extern int tee_main(int argc, char** argv);
 extern int test_main(int argc, char** argv);
 extern int telnet_main(int argc, char** argv);
 extern int touch_main(int argc, char** argv);
 extern int tr_main(int argc, char** argv);
 extern int true_main(int argc, char** argv);
 extern int tput_main(int argc, char** argv);
 extern int tryopen_main(int argc, char** argv);
 extern int tty_main(int argc, char** argv);
 extern int umount_main(int argc, char** argv);
 extern int uname_main(int argc, char** argv);
 extern int uniq_main(int argc, char** argv);
 extern int unix2dos_main(int argc, char** argv);
 extern int unrpm_main(int argc, char** argv);
 extern int update_main(int argc, char** argv);
 extern int uptime_main(int argc, char** argv);
 extern int usleep_main(int argc, char** argv);
 extern int uuencode_main(int argc, char** argv);
 extern int uudecode_main(int argc, char** argv);
 extern int wc_main(int argc, char** argv);
 extern int wget_main(int argc, char** argv);
 extern int which_main(int argc, char** argv);
 extern int whoami_main(int argc, char** argv);
 extern int xargs_main(int argc, char** argv);
 extern int yes_main(int argc, char** argv);
 
 extern const char ar_usage[];
 extern const char basename_usage[];
 extern const char cat_usage[];
 extern const char chgrp_usage[];
 extern const char chmod_usage[];
 extern const char chown_usage[];
 extern const char chroot_usage[];
 extern const char chvt_usage[];
 extern const char clear_usage[];
 extern const char cp_usage[];
 extern const char cut_usage[];
 extern const char date_usage[];
 extern const char dc_usage[];
 extern const char dd_usage[];
 extern const char deallocvt_usage[];
 extern const char df_usage[];
 extern const char dirname_usage[];
 extern const char dmesg_usage[];
 extern const char dos2unix_usage[];
 extern const char du_usage[];
 extern const char dumpkmap_usage[];
 extern const char dutmp_usage[];
 extern const char echo_usage[];
 extern const char expr_usage[];
 extern const char false_usage[];
 extern const char fdflush_usage[];
 extern const char find_usage[];
 extern const char free_usage[];
 extern const char freeramdisk_usage[];
 extern const char fsck_minix_usage[];
 extern const char grep_usage[];
 extern const char gunzip_usage[];
 extern const char gzip_usage[];
 extern const char halt_usage[];
 extern const char head_usage[];
 extern const char hostid_usage[];
 extern const char hostname_usage[];
 extern const char id_usage[];
 extern const char insmod_usage[];
 extern const char kill_usage[];
 extern const char killall_usage[];
 extern const char length_usage[];
 extern const char ln_usage[];
 extern const char loadacm_usage[];
 extern const char loadfont_usage[];
 extern const char loadkmap_usage[];
 extern const char logger_usage[];
 extern const char logname_usage[];
 extern const char ls_usage[];
 extern const char lsmod_usage[];
 extern const char makedevs_usage[];
 extern const char md5sum_usage[];
 extern const char mkdir_usage[];
 extern const char mkfifo_usage[];
 extern const char mkfs_minix_usage[];
 extern const char mknod_usage[];
 extern const char mkswap_usage[];
 extern const char mktemp_usage[];
 extern const char more_usage[];
 extern const char mount_usage[]; 
 extern const char mt_usage[];
 extern const char mv_usage[];
 extern const char nc_usage[];
 extern const char nslookup_usage[];
 extern const char ping_usage[];
 extern const char poweroff_usage[];
 extern const char printf_usage[];
 extern const char ps_usage[];
 extern const char pwd_usage[];
 extern const char rdate_usage[];
 extern const char reboot_usage[];
 extern const char renice_usage[];
 extern const char reset_usage[];
 extern const char rm_usage[];
 extern const char rmdir_usage[];
 extern const char rmmod_usage[];
 extern const char sed_usage[];
 extern const char setkeycodes_usage[];
 extern const char shell_usage[];
 extern const char sleep_usage[];
 extern const char sort_usage[];
 extern const char swapoff_usage[];
 extern const char swapon_usage[];
 extern const char sync_usage[];
 extern const char syslogd_usage[];
 extern const char tail_usage[];
 extern const char tar_usage[];
 extern const char tee_usage[];
 extern const char telnet_usage[];
 extern const char test_usage[];
 extern const char touch_usage[];
 extern const char tr_usage[];
 extern const char true_usage[];
 extern const char tty_usage[];
 extern const char umount_usage[];
 extern const char uname_usage[];
 extern const char uniq_usage[];
 extern const char unix2dos_usage[];
 extern const char unrpm_usage[];
 extern const char update_usage[];
 extern const char uptime_usage[];
 extern const char usleep_usage[];
 extern const char uudecode_usage[];
 extern const char uuencode_usage[];
 extern const char wc_usage[];
 extern const char wget_usage[];
 extern const char which_usage[];
 extern const char whoami_usage[];
 extern const char xargs_usage[];
 extern const char yes_usage[];
 
 extern const char *applet_name;
 
 extern void usage(const char *usage) __attribute__ ((noreturn));
 extern void errorMsg(const char *s, ...) __attribute__ ((format (printf, 1, 2)));
 extern void fatalError(const char *s, ...) __attribute__ ((noreturn, format (printf, 1, 2)));
 
 const char *modeString(int mode);
 const char *timeString(time_t timeVal);
 int isDirectory(const char *name, const int followLinks, struct stat *statBuf);
 int isDevice(const char *name);
 
 typedef struct ino_dev_hash_bucket_struct {
   struct ino_dev_hash_bucket_struct *next;
   ino_t ino;
   dev_t dev;
   char name[1];
 } ino_dev_hashtable_bucket_t;
 int is_in_ino_dev_hashtable(const struct stat *statbuf, char **name);
 void add_to_ino_dev_hashtable(const struct stat *statbuf, const char *name);
 void reset_ino_dev_hashtable(void);
 
 int copyFile(const char *srcName, const char *destName,
 		 int setModes, int followLinks, int forceFlag);
 int copySubFile(int srcFd, int dstFd, size_t remaining);
 char *buildName(const char *dirName, const char *fileName);
 int makeString(int argc, const char **argv, char *buf, int bufLen);
 char *getChunk(int size);
 char *chunkstrdup(const char *str);
 void freeChunks(void);
 int fullWrite(int fd, const char *buf, int len);
 int fullRead(int fd, char *buf, int len);
 int recursiveAction(const char *fileName, int recurse, int followLinks, int depthFirst,
 	  int (*fileAction) (const char *fileName, struct stat* statbuf, void* userData),
 	  int (*dirAction) (const char *fileName, struct stat* statbuf, void* userData),
 	  void* userData);
 
 extern int createPath (const char *name, int mode);
 extern int parse_mode( const char* s, mode_t* theMode);
 
 extern int get_kernel_revision(void);
 
 extern int get_console_fd(char* tty_name);
 extern struct mntent *findMountPoint(const char *name, const char *table);
 extern void write_mtab(char* blockDevice, char* directory, 
 	char* filesystemType, long flags, char* string_flags);
 extern void erase_mtab(const char * name);
 extern void mtab_read(void);
 extern char *mtab_first(void **iter);
 extern char *mtab_next(void **iter);
 extern char *mtab_getinfo(const char *match, const char which);
 extern int check_wildcard_match(const char* text, const char* pattern);
 extern long getNum (const char *cp);
 extern pid_t* findPidByName( char* pidName);
 extern int find_real_root_device_name(char* name);
 extern char *get_line_from_file(FILE *file);
 extern void print_file(FILE *file);
 extern int print_file_by_name(char *filename);
 extern char process_escape_sequence(char **ptr);
 extern char *get_last_path_component(char *path);
 extern void xregcomp(regex_t *preg, const char *regex, int cflags);
 
 #ifndef DMALLOC 
 extern void *xmalloc (size_t size);
 extern void *xrealloc(void *old, size_t size);
 extern void *xcalloc(size_t nmemb, size_t size);
 extern char *xstrdup (const char *s);
 #endif
 extern char *xstrndup (const char *s, int n);
 
 
 /* These parse entries in /etc/passwd and /etc/group.  This is desirable
  * for BusyBox since we want to avoid using the glibc NSS stuff, which
  * increases target size and is often not needed embedded systems.  */
 extern long my_getpwnam(char *name);
 extern long my_getgrnam(char *name);
 extern void my_getpwuid(char *name, long uid);
 extern void my_getgrgid(char *group, long gid);
 extern long my_getpwnamegid(char *name);
 
 extern int device_open(char *device, int mode);
 
 #if defined BB_FEATURE_MOUNT_LOOP
 extern int del_loop(const char *device);
 extern int set_loop(const char *device, const char *file, int offset, int *loopro);
 extern char *find_unused_loop_device (void);
 #endif
 
 
 #if (__GLIBC__ < 2) && (defined BB_SYSLOGD || defined BB_INIT)
 extern int vdprintf(int d, const char *format, va_list ap);
 #endif
 
 #if defined BB_NFSMOUNT
 int nfsmount(const char *spec, const char *node, int *flags,
 	     char **extra_opts, char **mount_opts, int running_bg);
 #endif
 
 #ifndef RB_POWER_OFF
 /* Stop system and switch power off if possible.  */
 #define RB_POWER_OFF   0x4321fedc
 #endif
 
 /* Include our own copy of struct sysinfo to avoid binary compatability
  * problems with Linux 2.4, which changed things.  Grumble, grumble. */
 struct sysinfo {
 	long uptime;			/* Seconds since boot */
 	unsigned long loads[3];		/* 1, 5, and 15 minute load averages */
 	unsigned long totalram;		/* Total usable main memory size */
 	unsigned long freeram;		/* Available memory size */
 	unsigned long sharedram;	/* Amount of shared memory */
 	unsigned long bufferram;	/* Memory used by buffers */
 	unsigned long totalswap;	/* Total swap space size */
 	unsigned long freeswap;		/* swap space still available */
 	unsigned short procs;		/* Number of current processes */
 	unsigned long totalhigh;	/* Total high memory size */
 	unsigned long freehigh;		/* Available high memory size */
 	unsigned int mem_unit;		/* Memory unit size in bytes */
 	char _f[20-2*sizeof(long)-sizeof(int)];	/* Padding: libc5 uses this.. */
 };
 extern int sysinfo (struct sysinfo* info);
 
 /* Bit map related macros -- libc5 doens't provide these... sigh.  */
 #ifndef setbit
 #define NBBY            CHAR_BIT
 #define setbit(a,i)     ((a)[(i)/NBBY] |= 1<<((i)%NBBY))
 #define clrbit(a,i)     ((a)[(i)/NBBY] &= ~(1<<((i)%NBBY)))
 #define isset(a,i)      ((a)[(i)/NBBY] & (1<<((i)%NBBY)))
 #define isclr(a,i)      (((a)[(i)/NBBY] & (1<<((i)%NBBY))) == 0)
 #endif
 
 #endif /* _BB_INTERNAL_H_ */
